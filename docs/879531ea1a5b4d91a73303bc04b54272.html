<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Primary Meta Tags -->
  <title>Vizlog</title>
  <meta name="title" content="Vizlog">
  <meta name="description" content="Collection of unusual experiments and Ethical hacking notes">

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="http://vshalson.tech/">
  <meta property="og:title" content="Vizlog">
  <meta property="og:description" content="Collection of unusual experiments and Ethical hacking notes">
  <meta property="og:image" content="">

  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content="http://vshalson.tech/">
  <meta property="twitter:title" content="Vizlog">
  <meta property="twitter:description" content="Collection of unusual experiments and Ethical hacking notes">
  <meta property="twitter:image" content="">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- iOS Safari -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <!-- Chrome, Firefox OS and Opera Status Bar Color -->
  <meta name="theme-color" content="#FFFFFF">
  <meta property="og:title" content="KataCoda : Docker Foundations">
    <meta name="description" content="Documenting Katacoda learnings">
  <meta property="og:description" content="Documenting Katacoda learnings">
    <!-- following viz change -->
    <meta property="og:type" content="blog">
  <title>KataCoda : Docker Foundations</title>
  <!-- Favicon -->
    <link rel="shortcut icon" href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fb71620e3-c96f-4528-8d97-b288c190e643%2FRengoku_kyoujurou_(kimetsu_no_yaiba).jpeg?table=collection&id=59e00ea3-c06b-463c-8165-ad7448059625">
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css">
  <link rel="stylesheet" type="text/css"
    href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.19.0/themes/prism.min.css">
  <link rel="stylesheet" type="text/css" href="css/SourceSansPro.css">
  <link rel="stylesheet" type="text/css" href="css/notablog.css">
  <link rel="stylesheet" type="text/css" href="css/theme.css">
  <style>
    :root {
      font-size: 18px;
    }

    .DateTagBar {
      margin-top: 1.0rem;
    }
  </style>
</head>

<body>
  <nav class="Navbar">
    <a href="index.html">
      <div class="Navbar__Btn"><span><img class="inline-img-icon" src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fb71620e3-c96f-4528-8d97-b288c190e643%2FRengoku_kyoujurou_(kimetsu_no_yaiba).jpeg?table=collection&id=59e00ea3-c06b-463c-8165-ad7448059625"></span> <span>Home</span></div>
    </a>
                    <span class="Navbar__Delim">&centerdot;</span>
    <a href="about.html">
      <div class="Navbar__Btn"><span><img class="inline-img-icon" src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fb0876588-8392-4afd-88f2-2b79f1fa471b%2FTwitter.jpeg?table=block&id=8b7e8994-2179-42f6-99c0-c6d968b07ea5"></span> <span>You don't know me?</span></div>
    </a>
                                                                                                                                                          </nav>
  <header class="Header">
          <div class="Header__Spacer Header__Spacer--NoCover">
    </div>
        <div class="Header__Icon"><span>⏱️</span></div>
        <h1 class="Header__Title">KataCoda : Docker Foundations</h1>
            <div class="DateTagBar">
                          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--orange">
            <a href="tag/Docker.html">Docker</a>
          </span>
                  </div>
          </header>
      <article id="https://www.notion.so/879531ea1a5b4d91a73303bc04b54272" class="PageRoot"><div id="https://www.notion.so/137a6b453ec64300b025996c8e0ea4e2" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Container are Linux process.</span></span></p></div><pre id="https://www.notion.so/e2dc1c40c30e4b0bac6cf47a91d6e1d7" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment">#Launching Redis contianer</span>
docker run -d --name<span class="token operator">=</span>db redis:alpine
<span class="token comment">#Check  Process ID and Prent Process ID</span>
docker <span class="token function">top</span> db
<span class="token comment"># To list sub process use `Pstree`</span>
pstree -c -p -A <span class="token variable"><span class="token variable">$(</span>pgrep dockerd<span class="token variable">)</span></span></span></span></span></code></pre><div id="https://www.notion.so/aed089c8c14146019c345a82c5c64328" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Configuration of each process define in /proc dir.</span></span></p></div><blockquote id="https://www.notion.so/3ecd0d5d3c5b4f749643e01c9657ada9" class="ColorfulBlock ColorfulBlock--BgPink Quote"><span class="SemanticStringArray"><span class="SemanticString">Give me process ID, I&#x27;ll give you config dir.
- /proc</span></span></blockquote><pre id="https://www.notion.so/0bafcde6b77240d28984ded0cf98dacc" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token assign-left variable">DBPID</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>pgrep redis-server<span class="token variable">)</span></span>
<span class="token builtin class-name">echo</span> REDIS is <span class="token variable">$DBPID</span>
<span class="token comment">#here DBPID variable to get Process ID of running redis-server process</span>
<span class="token function">ls</span> /proc
And
<span class="token function">ls</span> /proc/<span class="token variable">$DBPID</span></span></span></span></code></pre><div id="https://www.notion.so/2b6126de312143c38a069bb1696bac2e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/e02da9729ff849b38def8eda46106761" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Namespaces</strong></span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/f695c7beb1a341bcba164290abab7e05" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Is to limit what process can see and access certain parts of system</span></span></li><li id="https://www.notion.so/0854b198e1a547259c61d18f895e8ca0" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">When container started, Docker runtime will create new namespaces to sandbox the process. By running the process in it&#x27;s own PID namespace.</span></span><div id="https://www.notion.so/fe853e6bb4af462ab8846a77855e5dfa" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://en.wikipedia.org/wiki/Linux_namespaces">https://en.wikipedia.org/wiki/Linux_namespaces</a></span></span></p></div><div id="https://www.notion.so/5016b413cae74cf88ab7c5290000f6f8" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Available Namespace:</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/3671b84852044a5b8d1c5e6578477f61" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Mount - mnt</span></span></li><li id="https://www.notion.so/abf8f4795d724d1eb1c6d669607ac67a" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Network - net</span></span></li><li id="https://www.notion.so/158d34b3643f40d4a39fbfec5ad21875" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Process ID - pid</span></span></li><li id="https://www.notion.so/34137a38cc134aacae620d53f5f54a7c" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Control groups - cgroup</span></span></li><li id="https://www.notion.so/b4b6be8d063e47e2bc3f0f20b3b4ba9f" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">UTS - hostnames</span></span></li></ul></li></ul><div id="https://www.notion.so/44b54c8afa7f4450987464ef86ad57b8" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/69e9d5f0ae8b41fab8c21ebb9333e502" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Unshare  : to launch &quot;contained process&quot;, unshared from parent</strong></span></span></p><div class="Text__Children"><div id="https://www.notion.so/9fd295f0d28b43c3a20102b6eeb63932" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Without using docker runtime, process can still have it&#x27;s own namespace.</span></span></p></div><pre id="https://www.notion.so/551f41e5a0a84723bcc8a71a41886fb4" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>unshare --help</span></span></span></code></pre><div id="https://www.notion.so/00935fefa845424d86c7fa207b8b37ab" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Aha, run bash prompt process seprately</span></span></p></div><pre id="https://www.notion.so/44b56abd4c164329b640a0f3c06bc8a8" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token function">sudo</span> unshare --fork --pid --mount-prac <span class="token function">bash</span>
<span class="token function">ps</span>
<span class="token punctuation">..</span> <span class="token builtin class-name">continue</span> experimenting your shit
<span class="token builtin class-name">exit</span></span></span></span></code></pre></div></div><div id="https://www.notion.so/65832cab54c84440a7b34508aca7e6bf" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">What happens when we share a namespace?</span></span></p></div><div id="https://www.notion.so/310551009fab44019435f27c6aa594f4" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">It allows for process to reused the same namespace,allow to view and interact.</span></span></p></div><div id="https://www.notion.so/018fd656401042f6a02ed54863be8051" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F2dcb17ac-42b2-4b4b-b662-73e1f8fac683%2FUntitled.png?width=658&amp;table=block&amp;id=018fd656-4010-42f6-a02e-d54863be8051"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F2dcb17ac-42b2-4b4b-b662-73e1f8fac683%2FUntitled.png?width=658&amp;table=block&amp;id=018fd656-4010-42f6-a02e-d54863be8051" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/a80fa3a8219d4c1786c4812913af8bb1" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">NSEnter</strong></span><span class="SemanticString"> : to attach process to existing Namespace (used for debugging)</span></span></p></div><pre id="https://www.notion.so/f1387ea2fc90418e9b6381deb8a1caf6" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>nsenter --target <span class="token variable">$DBPID</span> --mount --uts --ipc --net --pid <span class="token function">ps</span> aux
<span class="token comment"># target process </span></span></span></span></code></pre><div id="https://www.notion.so/da6425b4ab2b4416a7a71f6305938f35" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Using Docker, we can share namespaces </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">container:&lt;container_name&gt;</code></span><span class="SemanticString">    </span></span></p><div class="Text__Children"><div id="https://www.notion.so/ecacb24f032f4fe08df1cf27dc60e604" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Connect ngix to DB namespace</span></span></p></div><div id="https://www.notion.so/29c60a65de774bb395758e6413779bc4" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fb3058904-70a3-44d3-b3b1-5ee34695baec%2FUntitled.png?width=659&amp;table=block&amp;id=29c60a65-de77-4bb3-9575-8e6413779bc4"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fb3058904-70a3-44d3-b3b1-5ee34695baec%2FUntitled.png?width=659&amp;table=block&amp;id=29c60a65-de77-4bb3-9575-8e6413779bc4" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/eae24e4c0ad640c1b6937e64815f1495" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Make variable, WEBPID </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">WEBPID=$(pgre nginx | tail -n1)</code></span></span></p></div><div id="https://www.notion.so/050a8681f1064b6085199327a06626ea" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Namespace for both process points to same location.</span></span></p></div></div></div><div id="https://www.notion.so/9dc07638c2734afbac16e90fc459aa60" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/1fae1911bfa64371acd54aeff0ef53b0" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Control groups (Cgroups) : limit amout of resources a process can consume.</span></span></p></div><pre id="https://www.notion.so/3f12fd0791a0457f996ea39cf8bb24b7" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># CHeck cgroup mapping</span>
<span class="token function">cat</span> /proc/<span class="token variable">$DBPID</span>/cgroup
<span class="token comment"># Check CPU stats for process</span>
<span class="token function">cat</span> /sys/fs/cgroup/cpu,cpuacct/docker/<span class="token variable">$DBID</span>/cpuacct.stat
<span class="token comment"># CHeck CPU share limit</span>
<span class="token function">cat</span> /sys/fs/cgroup/cpu,cpuacct/docker/<span class="token variable">$DBID</span>/cpuacct.shares

Dcoker Cgroup stored @ /sys/fs/cgroup/memory/docker/</span></span></span></code></pre><div id="https://www.notion.so/214ed40354564463b7001da9ee30a2d4" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Docker can control memory limits via Cgroup settings.</span></span></p><div class="Text__Children"><div id="https://www.notion.so/68075f26d02c46a88290bdb0585e9d46" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">By default, container have no limit on memory.</span></span></p></div><pre id="https://www.notion.so/aee911c9a8724fe696cc5a39aa0448aa" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>docker stats <span class="token operator">&lt;</span>container_name<span class="token operator">></span> --no-stream</span></span></span></code></pre><div id="https://www.notion.so/b211d2efea1e4e8189d217031d5e96e3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">To set limits,</span></span></p></div><pre id="https://www.notion.so/ef671e69e61e44b69c3190f1596b5f80" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token builtin class-name">echo</span> <span class="token number">8000000</span> <span class="token operator">></span> /sys/fs/cgroup/memory/docker/<span class="token variable">$DBID</span>/memory.limit_in_bytes
Here <span class="token number">8000000</span> <span class="token keyword">in</span> bytes to <span class="token number">7.629</span> mibibyte</span></span></span></code></pre></div></div><div id="https://www.notion.so/8b24886c2ddb4a9b8175c100061c235a" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F81178178-b50e-4e74-bea7-9758e0440277%2FUntitled.png?width=1222&amp;table=block&amp;id=8b24886c-2ddb-4a9b-8175-c100061c235a"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F81178178-b50e-4e74-bea7-9758e0440277%2FUntitled.png?width=1222&amp;table=block&amp;id=8b24886c-2ddb-4a9b-8175-c100061c235a" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/a30f8c1d5ab048a3ac2cc4ebdee596ec" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/89456f5c27594776ac8dd2eac66783a3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/5825feae146a40dfb7773b67caa4b5e8" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">AppArmor</strong></span></span></p><div class="Text__Children"><div id="https://www.notion.so/1ceb27f3ccae4ae7b6de8e82e4d0b503" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">All actions with Linux done via syscalls.</span></span></p></div><div id="https://www.notion.so/fcc99cf795934cdc98deb56c02b2da3d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Kernel has 330 syscalls to perform operations.</span></span></p></div><div id="https://www.notion.so/01ee8dcd71f341579d63c49fcf581eee" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">All applications use combination of syscalls to perform required operatn.</span></span></p></div><div id="https://www.notion.so/514c98d3b64d43b8891e69b774174785" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">AppArmor is a application defined profile that describes which parts of the system a process can access.</strong></span></span></p></div></div></div><div id="https://www.notion.so/18e9daef22c049f693bc513115c25aaf" class="Divider"></div><div id="https://www.notion.so/b78d7a2679f44124963e7ebfee7ac01b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><h2 id="https://www.notion.so/2fea64fca4ac4b778cf77857ee776d97" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/2fea64fca4ac4b778cf77857ee776d97"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Scenario : 2</span></span></h2><div id="https://www.notion.so/2d410498950947fc954db21fb236a50f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Container image: container image is tar file containing tar files. Each tar file is layer. Once all tar file extract into same location then you have container&#x27;s filesystem.</span></span></p></div><div id="https://www.notion.so/1eb96055908d4756a53e53c95b211283" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Feed561f9-77bb-40b1-a924-87c2e7e233ca%2FUntitled.png?width=781&amp;table=block&amp;id=1eb96055-908d-4756-a53e-53c95b211283"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Feed561f9-77bb-40b1-a924-87c2e7e233ca%2FUntitled.png?width=781&amp;table=block&amp;id=1eb96055-908d-4756-a53e-53c95b211283" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/c11da411889e4d36b814aa196ab5f2d8" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Image also includes meta deta about version info and tag name.</span></span></p></div><div id="https://www.notion.so/b5b96df8600b4145a4a7e0b8714d98ab" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F7e70f63f-82b4-4e03-ad13-fed77eb792be%2FUntitled.png?width=747&amp;table=block&amp;id=b5b96df8-600b-4145-a4a7-e0b8714d98ab"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F7e70f63f-82b4-4e03-ad13-fed77eb792be%2FUntitled.png?width=747&amp;table=block&amp;id=b5b96df8-600b-4145-a4a7-e0b8714d98ab" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/5393c8c2170242e3a78c3c1c660705a8" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">And extract it further,</span></span></p></div><div id="https://www.notion.so/e761d63d52004d25a76e212f1d6e6a29" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fcfaef57e-3ad0-402f-807c-e2526adf0e3e%2FUntitled.png?width=819&amp;table=block&amp;id=e761d63d-5200-4d25-a76e-212f1d6e6a29"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fcfaef57e-3ad0-402f-807c-e2526adf0e3e%2FUntitled.png?width=819&amp;table=block&amp;id=e761d63d-5200-4d25-a76e-212f1d6e6a29" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/bf672862b9b24c4b8153303185a13423" class="Divider"></div><div id="https://www.notion.so/d819209c461b48288e112c309e9f40bb" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/f75275b20d8a4980ac1526cb1d1f0504" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Create image with dockerfile</strong></span></span></p><div class="Text__Children"><div id="https://www.notion.so/373805f0e75843eea1d831e1ffda9144" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Import tar file to create an image from scratch.</span></span></p></div><div id="https://www.notion.so/85a1f379049a4dc982fc3f6081a457f5" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Here busybox (package with standard unix programs) as base.</span></span></p></div></div></div><pre id="https://www.notion.so/c6ad4ab7768a4dc792c071bf2bb8f766" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># Download and extract busybox rootfs</span>
<span class="token function">curl</span> -LO https://raw.githubusercontent.com/moby/moby/a575b0b1384b2ba89b79cbd7e770fbeb616758b3/contrib/mkimage/busybox-static <span class="token operator">&amp;&amp;</span> <span class="token function">chmod</span> +x busybox-static
<span class="token comment"># To download rootfs and main binaries </span>
./busybox-static busybox
<span class="token comment"># create a file</span>
<span class="token builtin class-name">echo</span> KatacodaPrivateBuild <span class="token operator">></span> busybox/release
<span class="token comment"># dir can into tar and import into docker as an image.</span>
<span class="token function">tar</span> -C busybox -c <span class="token builtin class-name">.</span> <span class="token operator">|</span> docker <span class="token function">import</span> - busybox
<span class="token comment"># launch as container, here to print release</span>
docker run busybox <span class="token function">cat</span> /release</span></span></span></code></pre><div id="https://www.notion.so/412dfc34d2de45d99b546d161e891670" class="Divider"></div><h1 id="https://www.notion.so/9a3f3cfab0b645efa6ff779b6909dcbc" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/9a3f3cfab0b645efa6ff779b6909dcbc"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Docker foundations</span></span></h1><h3 id="https://www.notion.so/5bd086118c8b495682c44673580bce5a" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/5bd086118c8b495682c44673580bce5a"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Deploy first Docker Container</span></span></h3><pre id="https://www.notion.so/1ce6d9d26f9843389723d01b2a7ee882" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># search docker image</span>
docker search redis

<span class="token comment"># Run command in foreground</span>
docker run -d redis
<span class="token number">555555</span></span></span></span></code></pre><div id="https://www.notion.so/6a072856e7a34c09b1c9b16e29a3d922" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><h2 id="https://www.notion.so/72bf42378a95463cb48968c27223ec89" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/72bf42378a95463cb48968c27223ec89"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Deploy Static HTML Website as Container</span></span></h2><ul class="BulletedListWrapper"><li id="https://www.notion.so/077b94a5647443f49533020efd12acbc" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Create Dockerfile</span></span><ul class="BulletedListWrapper"><li id="https://www.notion.so/74a01e6f877443458033b7280aa35801" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Docker Images start from a base image.</span></span></li><li id="https://www.notion.so/8526efcd3a174f0096b8d6fec3527c6f" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Base image is defined as instruction in Dockerfile.</span></span></li></ul></li><li id="https://www.notion.so/1fbf017bbea840668d4ad246b8e56d27" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Build Docker Image</span></span><ul class="BulletedListWrapper"><li id="https://www.notion.so/254c61bb674a471da884239f9ee38e88" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Build command takes in some diff parameters.</span></span></li></ul><pre id="https://www.notion.so/1549f236425c4ba2bc94c0b1baf9bd84" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># Build our static HTML</span>
docker build -t webserver-image:v1 <span class="token builtin class-name">.</span></span></span></span></code></pre></li><li id="https://www.notion.so/3e880d40d069477781879c683422e700" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Run </span></span><ul class="BulletedListWrapper"><li id="https://www.notion.so/5f7a71681384499baa9e50feeb137ae1" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">When container launches, it&#x27;s sandboxed from other processes and networks on the host.</span></span></li></ul><pre id="https://www.notion.so/c3a7d0dff37b44609b481334d5afe4aa" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>docker run -d -p <span class="token number">80</span>:80 webserver-image:v1
	-d <span class="token builtin class-name">:</span> run <span class="token keyword">in</span> background
	-p <span class="token builtin class-name">:</span> <span class="token builtin class-name">bind</span> port</span></span></span></code></pre></li></ul><div id="https://www.notion.so/7d661fe351ae4c969fc46e58090293cf" class="Divider"></div><h3 id="https://www.notion.so/e2712b828c6b4e6392ee4f5055b5d0f1" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/e2712b828c6b4e6392ee4f5055b5d0f1"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Optimise Dockerfile with OnBuild</span></span></h3><div id="https://www.notion.so/caab341501ff48798af47f97d4e4b342" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Dockerfile executes in order from top to bottom, one can trigger instruction to execute later time when image is used as base for another image.</span></span></p></div><div id="https://www.notion.so/20249428d05b4221ba91a66d5cc43ffe" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F13addfcf-0d6c-4527-9521-c10f91565282%2FUntitled.png?width=582&amp;table=block&amp;id=20249428-d05b-4221-ba91-a66d5cc43ffe"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F13addfcf-0d6c-4527-9521-c10f91565282%2FUntitled.png?width=582&amp;table=block&amp;id=20249428-d05b-4221-ba91-a66d5cc43ffe" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/af5666533bb04e948cd1a0d696072ce2" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">(Image Source: </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://katacoda.com/courses/docker/4">https://katacoda.com/courses/docker/4</a></span><span class="SemanticString"> )</span></span></p></div><div id="https://www.notion.so/0a5c1aeeb2e44dda81a95029f98e04e6" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Application Dockerfile</span></span></p></div><div id="https://www.notion.so/e76b98f47d3e4a0ab2e0974cdc6bb2bc" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F8f352165-c254-4c7f-a384-a42cc70de843%2FUntitled.png?width=592&amp;table=block&amp;id=e76b98f4-7d3e-4a0a-b2e0-974cdc6bb2bc"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F8f352165-c254-4c7f-a384-a42cc70de843%2FUntitled.png?width=592&amp;table=block&amp;id=e76b98f4-7d3e-4a0a-b2e0-974cdc6bb2bc" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/f31807da1e7d41dab092676215dea3df" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/c077a4445bcd40a0a88cac6dc2b77aa8" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Just like we have .gitignore, to prevent files or dir from include by mistake in images.</span></span></p></div><blockquote id="https://www.notion.so/7bd0a2af4c3049ec91d5a208d927b6bd" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString">If you need to use the passwords as part of a </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">RUN</strong></span><span class="SemanticString"> command then you need to copy, execute and delete the files as part of </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">a single RUN command</strong></span><span class="SemanticString">. Only the final state of the Docker container is persisted inside the image.</span></span></blockquote><div id="https://www.notion.so/e7b20eedd5564901800faf44e109832a" class="Divider"></div><h2 id="https://www.notion.so/5217ededcae24d67aab6323c092ab7a8" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/5217ededcae24d67aab6323c092ab7a8"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Data container</span></span></h2><div id="https://www.notion.so/1270b7e536c345f099f6c57e881e34f3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Responsible to be place to store or manage data.</span></span></p></div><div id="https://www.notion.so/220573a2bff44a1d9df5a5fd147504c8" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">It&#x27;s managed by host system but don&#x27;t run on </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">docker ps</code></span></span></p></div><div id="https://www.notion.so/d8bf4a397c534d6b941f640cfe9e3889" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Scenario: </span></span></p></div><pre id="https://www.notion.so/2077ef0a928244779a9671e1b6c23b87" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># Create data container for storing config files using</span>
docker create -v /config --name dataContainer busybox

<span class="token comment"># COpy file using cp, here copy config.conf to dataContainer</span>
docker <span class="token function">cp</span> config.conf dataContainer:/config/

<span class="token comment"># Mount using --volumes-from</span>
docker run --volumes-from dataContainer ubuntu <span class="token function">ls</span> /config

<span class="token comment"># Export/Import Containers, move to another machine</span>
docker <span class="token builtin class-name">export</span> dataContainer <span class="token operator">></span> dataContainer.tar
docker <span class="token function">import</span> dataContainer.tar</span></span></span></code></pre><div id="https://www.notion.so/d462920d2ff745848dcb0d69220d9649" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Here, DataContainer has our config file, we reference the container when we launch depended container here ubuntu one.</span></span></p></div><h2 id="https://www.notion.so/80aa7008514e418aa7a0a840d79f70bf" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/80aa7008514e418aa7a0a840d79f70bf"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Communicating between Containers</span></span></h2><div id="https://www.notion.so/d1c42a435c7846b6b6714abe5e69d291" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Define friendly name container you&#x27;re connecting to.</span></span></p></div><div id="https://www.notion.so/745e7ce0d4bf4eafac48cb09b0e4db51" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Scenario:</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/d1a291a6c5804758afc453820389d871" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Start Data store with friendly name</span></span><pre id="https://www.notion.so/48d85c49d9b94a04add95df73cf03454" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>docker run -d --name redis-server redis</span></span></span></code></pre></li><li id="https://www.notion.so/9f2341f880ea452ab7ddbd4236142989" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">When link created, Docker will do</span></span><div id="https://www.notion.so/ba1adeba1c274902b6015f955ae5e2fb" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">The link updates /etc/hosts and environment variables to allow containers to discover and communicate</span></span></p></div><pre id="https://www.notion.so/fc0c1804f9b2471989308592a7cbb514" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># output env variable with env command</span>
docker run --link redis-server:redis alpine <span class="token function">env</span>

<span class="token comment"># It will update HOSTS file wiht entry for source container for source container with three names, the **original**, the **alias** and **hash-id.**</span>
<span class="token comment"># output container host entry</span>
docker run --link redis-server:redis alpine <span class="token function">cat</span> /etc/hostss</span></span></span></code></pre></li><li id="https://www.notion.so/81e48c16c7134cdd840070f97d5411e4" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Connect to App, applications can connect and communicate with source container in usual way.</span></span></li></ul><pre id="https://www.notion.so/9969c257fea1407e9013f9f151da1686" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>docker run -d -p <span class="token number">3000</span>:3000 --link redis-server:redis katacoda/redis-node-docker-example</span></span></span></code></pre><h2 id="https://www.notion.so/d0f2175425ae47b5a24c12d512c2aaf2" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/d0f2175425ae47b5a24c12d512c2aaf2"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Docker network</span></span></h2><div id="https://www.notion.so/dce847a56e6d49a08dfe02f9178133a7" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Similar to physical network, allow container to come and go more freely than using links.</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/e1ca4e93274949dfa67af1422bfac059" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Create Network</span></span><div id="https://www.notion.so/1ec38b5dadf1438c8ae58d981b0fa1d9" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Network allow us to attach multiple containers which able to discover each other.</span></span></p></div><pre id="https://www.notion.so/545ba46ac07c447482983295ede7e1f2" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># create network with predefined name</span>
docker network create backend-network

<span class="token comment"># launch new container, --net flag to assign network</span>
docker run -d --name<span class="token operator">=</span>redis --net<span class="token operator">=</span>backend-network redis</span></span></span></code></pre></li><li id="https://www.notion.so/3154b98309a04174a41497b718727e4f" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Network Communication</span></span><div id="https://www.notion.so/9aaf4640496948f382a27f03845abc15" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Here Docker not assigns env variables or updates host file of containers.</span></span></p></div><div id="https://www.notion.so/a414d3652e5b4ba6b91b3ee10b06b95b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Instead, container communicate via Embedded DNS server in Docker. DNS assign to all container via IP 127.0.0.11 and set </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">resolve.conf</code></span><span class="SemanticString"> file.</span></span></p></div><div id="https://www.notion.so/7c9875c7e03e486495cb4354e1fc41d2" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">When containers try access other container via well-known name, as Redis, DNS server will return IP addr of correct container.</span></span></p></div><pre id="https://www.notion.so/d99d76d253a245ae8ee13d3374484b21" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>docker run --net<span class="token operator">=</span>backend-network alpine <span class="token function">ping</span> -c1 redis</span></span></span></code></pre></li><li id="https://www.notion.so/859d9c5a23c2491fa0057d5a1730865d" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Connect Two containers</span></span><div id="https://www.notion.so/2093e449dc42466b9d5e20b3f4ca776f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Docker supports multiple network and container being attached to more than one network at same time.</span></span></p></div><pre id="https://www.notion.so/e594960fe56244aabbcb3d66d4210610" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># create network</span>
docker network create frontend-network

<span class="token comment"># connect command to attach existing container</span>
docker network connect frontend-network redis

<span class="token comment"># launch web-server, it'll communicate with redis instance</span>
docker run -d -p <span class="token number">3000</span>:3000 --net<span class="token operator">=</span>frontend-network katacoda/redis-node-docker-example</span></span></span></code></pre></li><li id="https://www.notion.so/cc28d3d9821547f7a2d5c1e05fedb900" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Disconnect Container</span></span><pre id="https://www.notion.so/dec1a727cba840fba45eb86da1725cbc" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># list networks on host</span>
docker network <span class="token function">ls</span>

<span class="token comment"># explore network to see containers attach and their IP addr</span>
docker network inspect frontend-network

<span class="token comment"># disconnect redis container from frontend-network</span>
docker network disconnect frontend-network redis</span></span></span></code></pre></li></ul><div id="https://www.notion.so/9d1796c91a92453484a0dd4fe13c4f4a" class="Divider"></div><h2 id="https://www.notion.so/d69e95a3a21442f3b6546c4defa8dcc9" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/d69e95a3a21442f3b6546c4defa8dcc9"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Persisting Data using Volumes</span></span></h2><pre id="https://www.notion.so/f69527ca791f47f68ddaf062e22868b0" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># Starting redis container, -v : create data volume.</span>
docker run -v /docker/redis-data:/data --name r1 -d redis <span class="token punctuation">\</span>
	redis-server --appendonly <span class="token function">yes</span>

<span class="token comment"># Pipe data into redis instance using </span>
<span class="token function">cat</span> data <span class="token operator">|</span> docker <span class="token builtin class-name">exec</span> -i r1 redis-cli --pipe

<span class="token comment"># Same dir can be mounted to second container, here for backup operation</span>
docker run -v /docker/redis-data:/backup ubuntu <span class="token function">ls</span> /backup

<span class="token comment"># --volumes-from : maps the mapped volume from source to container being launched</span>
docker run --volumes-from r1 -it ubuntu <span class="token function">ls</span> /data

<span class="token comment"># Mounting container can be prone to write, here specify read-only `:ro`</span>
docker run -v /docker/redis-data:/data:ro -it ubuntu <span class="token function">rm</span> -rf /data</span></span></span></code></pre><div id="https://www.notion.so/209e5c46ba0e42baaaa133723c192749" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><h2 id="https://www.notion.so/730ea8107c2947199c539a36277e8228" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/730ea8107c2947199c539a36277e8228"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Managing Log Files</span></span></h2><div id="https://www.notion.so/f67c9d8e44534a3d82d14a1262233c21" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Docker will track standard out and standard error output</span></span></p></div><pre id="https://www.notion.so/efcbda3666674f078b5022b4f053e2f9" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># to retrieve logs</span>
docker logs redis-server</span></span></span></code></pre><div id="https://www.notion.so/7bb99e021a3c4bdbb39e222709179c5c" class="ColorfulBlock ColorfulBlock--BgBlue Callout"><div class="Callout__Icon"><div class="Icon">🧭</div></div><p class="Callout__Content"><span class="SemanticStringArray"><span class="SemanticString">syslog is a widely used standard for message logging. It permits separation of the software that generates messages, the system that stores them, and the software that reports and analyses them</span></span></p></div><pre id="https://www.notion.so/0c27de436fc04bd5807a9d3acedc912d" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># command to redirect redis logs to syslog</span>
docker run -d --name redis-syslog --log-driver<span class="token operator">=</span>syslog redis

<span class="token comment"># Docker inspect to identify logging config for particular container</span>
$ docker inspect --format <span class="token string">'{{ .HostConfig.LogConfig }}'</span> redis-server
<span class="token punctuation">{</span>json-file map<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
$ docker inspect --format <span class="token string">'{{ .HostConfig.LogConfig }}'</span> redis-syslog
<span class="token punctuation">{</span>syslog map<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span></span></span></code></pre><div id="https://www.notion.so/39ba7e8b0d3f4efab474fac10a31224b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><h2 id="https://www.notion.so/923f43faaf7440049149302c918ce68c" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/923f43faaf7440049149302c918ce68c"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Ensuring Uptime</span></span></h2><div id="https://www.notion.so/e572e113313049159228dd2860ec6177" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Docker consider containers to exit with non-zero exit code as crashed, default crash container remain stopped.</span></span></p></div><div id="https://www.notion.so/d78965c5727644fbbc5e3a233c7c86a0" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Here we evaulate log, to diagnose the issue.</span></span></p></div><div id="https://www.notion.so/d1f117aeed88456080128ed604d70596" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Flag </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">--restart=on-failure:#</code></span><span class="SemanticString"> allows you to say how many times Docker should try again.</span></span></p></div><div id="https://www.notion.so/b31d6d41e62b4735bd0bc917122eb10e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">--restart=always</code></span><span class="SemanticString"> flag to automatically restart the container when is crashes</span></span></p></div><div id="https://www.notion.so/4fd325270aca48249b403d4a12fdf576" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Ff4c50a83-ca42-472b-814e-c0e2e15828bc%2FUntitled.png?width=947&amp;table=block&amp;id=4fd32527-0aca-4824-9b40-3d4a12fdf576"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Ff4c50a83-ca42-472b-814e-c0e2e15828bc%2FUntitled.png?width=947&amp;table=block&amp;id=4fd32527-0aca-4824-9b40-3d4a12fdf576" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/da8fc8c695ce445aa80cda2099500c01" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Ff927e055-0ed6-4264-9045-1e831aa1dedd%2FUntitled.png?width=951&amp;table=block&amp;id=da8fc8c6-95ce-445a-a80c-da2099500c01"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Ff927e055-0ed6-4264-9045-1e831aa1dedd%2FUntitled.png?width=951&amp;table=block&amp;id=da8fc8c6-95ce-445a-a80c-da2099500c01" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/600b6787ef874adfa1617ba1fc292691" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><h2 id="https://www.notion.so/07f9899e01914f35b1711fb61560df59" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/07f9899e01914f35b1711fb61560df59"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Docker Metadata &amp; Labels</span></span></h2><div id="https://www.notion.so/c980376136534e489d7409b0e3e40de8" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">For containers in production, it&#x27;s helpful to add metadata related to container like version details, who owns it or criteria which server they shud run on.</span></span></p></div><div id="https://www.notion.so/3cc3f7e0bb724ea9bc05687d723a2422" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Additional data managed via Docker Labels, it allows us to define custom metadata about container or image which inspected or used as part of filter.</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/31496c6f17a64efc9fca7efbff3f2d48" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Single Label : </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">l=&lt;value&gt;</code></span></span><pre id="https://www.notion.so/f93546d80ec24de8bcaf97f557745e8c" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>docker run -l <span class="token assign-left variable">user</span><span class="token operator">=</span><span class="token number">12345</span> -d redis</span></span></span></code></pre></li><li id="https://www.notion.so/ef7f4f61592d40e490f340a2fe1f6235" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">External File : while adding multiple labels, add through external file</span></span><pre id="https://www.notion.so/c8d8274f5c9e4657bc48379ab18ff4be" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># one label for user and second for role</span>
<span class="token builtin class-name">echo</span> 'user<span class="token operator">=</span><span class="token number">12345</span>` <span class="token operator">>></span> labels <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">echo</span> <span class="token string">'role=cache'</span> <span class="token operator">>></span> labels
<span class="token comment"># --labels-file=labels</span>
docker run --label-file<span class="token operator">=</span>labels -d redis</span></span></span></code></pre></li></ul><div id="https://www.notion.so/d338daebec9e45bd9ac0dd1d3fd93577" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">In case of Dockerfile,</strong></span></span></p></div><div id="https://www.notion.so/ef4c36117e754d898ef08daaa00dcaeb" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F9516fd26-c777-47c9-9a19-2aae5e1b7e49%2FUntitled.png?width=597&amp;table=block&amp;id=ef4c3611-7e75-4d89-8ef0-8daaa00dcaeb"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F9516fd26-c777-47c9-9a19-2aae5e1b7e49%2FUntitled.png?width=597&amp;table=block&amp;id=ef4c3611-7e75-4d89-8ef0-8daaa00dcaeb" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/7cdda0c8efd94f528414c43596399393" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">To view labels of container or image, use inspect</span></span></p></div><pre id="https://www.notion.so/74e8bb76ad854b9897e8378bccf5fdb6" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>docker inspect <span class="token operator">&lt;</span>container_name/image_name<span class="token operator">></span></span></span></span></code></pre><div id="https://www.notion.so/d510c7da562c4ba9a7822f929b1dd894" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Daemon Labels</strong></span></span></p></div><div id="https://www.notion.so/bfbc6382890841f196ee5c0b92eeb22d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">When launch instance of daemon, assign label to identify how it should be used.</span></span></p></div><pre id="https://www.notion.so/2cf08143d224419a8cb1cde2d468d7dc" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>docker -d -H unix:///var/rn/docker.sock <span class="token punctuation">\</span>
	--label com.katacoda.environment<span class="token operator">=</span><span class="token string">"production"</span></span></span></span></code></pre><div id="https://www.notion.so/dfc0b110e8fe4bfa9a458336085148fb" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/cb97f39c157b4be195fb781fd29e4a5d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><h2 id="https://www.notion.so/89b4d6612f234a39a4b0f88e050c9d2c" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/89b4d6612f234a39a4b0f88e050c9d2c"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Load Balancing Containers</span></span></h2><div id="https://www.notion.so/028ba589189b470292671b7d1047d34f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Here, we use the NGINX web server to load balance requests between two containers running on the host</span></span></p></div><div id="https://www.notion.so/07493688e9d64265ba9b0a585b8140f1" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">The Service Discovery pattern is where the application uses a third party system to identify the location of the target service. For example, if our application wanted to talk to a database, it would first ask an API what the IP address of the database is.</span></span></p></div><div id="https://www.notion.so/d6f2a81ec2694e7f82568f1aca193a10" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Step 1 - NGINX Proxy</strong></span></span></p></div><div id="https://www.notion.so/ea96eebbf830402aaa29db303382e3ba" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Nginx service running → dynamically discovery and update load balance configuration when new containers loaded.</span></span></p></div><div id="https://www.notion.so/895540c2ab564dbb80176862a4516497" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Properties -</strong></span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/8465f2cd6c4c4188b56038585ead32f5" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">First Port binding : here -p 80:80</span></span></li><li id="https://www.notion.so/b51de81b149f462087e6302d858b01b6" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Second mount docker.sock file, it&#x27;s connection to docker daemon running on host; -v /var/run/docker.sock:/tmp/docker.sock:ro </span></span></li><li id="https://www.notion.so/26421a6638734fd5866afdc851f28a75" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Third if request comes and it doesn&#x27;t make to specified host, then this default container will handle request : -e DEFAULTHOST=&lt;domain&gt;</span></span></li></ul><pre id="https://www.notion.so/947909a7c93642b3a93b62127c8a508a" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>docker run -d -p <span class="token number">80</span>:80 -e <span class="token assign-left variable">DEFAULT_HOST</span><span class="token operator">=</span>proxy.example -v /var/run/docker.sock:/tmp/docker.sock:ro --name nginx jwilder/nginx-proxy</span></span></span></code></pre><div id="https://www.notion.so/b3c2bfde0fbc42edb54acf66d6eb2c3a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Step 2 - Launch Contianer</strong></span></span></p></div><div id="https://www.notion.so/e4222adf6f0b41b7b0d9f887d849d62b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Specify VIRTUAL_HOST env variable, to define the domain where requests will come from and should be handled by container.</span></span></p></div><pre id="https://www.notion.so/549192cab2d24cd09c97e3db410dbe48" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>docker run -d -p <span class="token number">80</span> -e <span class="token assign-left variable">VIRTUAL_HOST</span><span class="token operator">=</span>proxy.example katacoda/docker-http-server</span></span></span></code></pre><div id="https://www.notion.so/ba0bea935dc84db18f283ab01f80b0fa" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Step 3 - Cluster</strong></span></span></p></div><div id="https://www.notion.so/1c19ea1a46694bedbe9a96e4f9f5c1ce" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Launch second container on same Vhost, after nginx-proxy configure the system in round-robin load balance (the first request will go to one container, the second request to a second container and then repeat in a circle).</span></span></p></div><pre id="https://www.notion.so/786f8db43f0045dbbf93bba38da16ab7" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># second container</span>
docker run -d -p <span class="token number">80</span> -e <span class="token assign-left variable">VIRTUAL_HOST</span><span class="token operator">=</span>proxy.example katacoda/docker-http-server</span></span></span></code></pre><div id="https://www.notion.so/b084b2ac4668489ba1bddbc86d0afcb2" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Step 4 - Auto generated NGINX config</strong></span></span></p></div><div id="https://www.notion.so/1b2b146815044b7bb9d29f824773c52d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Nginx-proxy auto create and configs nginx, to check final config file.</span></span></p></div><pre id="https://www.notion.so/1604b36b6a09436d9a0f2b4e5f04292c" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>docker <span class="token builtin class-name">exec</span> nginx <span class="token function">cat</span> /etc/nginx/conf.d/default.conf</span></span></span></code></pre><div id="https://www.notion.so/4024d2bbec124d72be9c89f9b9b1e031" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Faacc0288-078a-41a9-90a1-890bc0ce5adb%2FUntitled.png?width=1216&amp;table=block&amp;id=4024d2bb-ec12-4d72-be9c-89f9b9b1e031"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Faacc0288-078a-41a9-90a1-890bc0ce5adb%2FUntitled.png?width=1216&amp;table=block&amp;id=4024d2bb-ec12-4d72-be9c-89f9b9b1e031" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/c0b7c8f3a6aa4a6ea3ada2a6f85832b4" class="Divider"></div><h2 id="https://www.notion.so/93fe7e0a12344ecdbddf352009eede2e" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/93fe7e0a12344ecdbddf352009eede2e"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Docker-Compose</span></span></h2><pre id="https://www.notion.so/6cee4c5633d8494487cbfbbc4e87da41" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># to see details of launched container</span>
docker-compose <span class="token function">ps</span>

<span class="token comment"># access logs via stream</span>
docker-compose logs

<span class="token comment"># scale the number of web containers, following will scale no of web container</span>
docker-compose scale <span class="token assign-left variable">web</span><span class="token operator">=</span><span class="token number">3</span> 
<span class="token comment"># scale down back to one</span>
docker-compose scale <span class="token assign-left variable">web</span><span class="token operator">=</span><span class="token number">1</span>

<span class="token comment"># docker stop</span>
docker-compose stop</span></span></span></code></pre><h2 id="https://www.notion.so/38e610882a964df380111f8c93176508" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/38e610882a964df380111f8c93176508"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Docker stats</span></span></h2><pre id="https://www.notion.so/3d4adc2fa615414facd8846d5ad3938a" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># For single container</span>
docker stats nginx

<span class="token comment"># For multiple container</span>
docker <span class="token function">ps</span> -q <span class="token operator">|</span> <span class="token function">xargs</span> docker stats</span></span></span></code></pre><h2 id="https://www.notion.so/3101dfcba6a740abb1308940155aa087" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/3101dfcba6a740abb1308940155aa087"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Formatting Docker ps output</span></span></h2><div id="https://www.notion.so/c9c1a4e50c1749d48c2559be9d433592" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F8c56ecbe-414b-4340-a94f-4303e935a49f%2FUntitled.png?width=1245&amp;table=block&amp;id=c9c1a4e5-0c17-49d4-8c25-59be9d433592"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F8c56ecbe-414b-4340-a94f-4303e935a49f%2FUntitled.png?width=1245&amp;table=block&amp;id=c9c1a4e5-0c17-49d4-8c25-59be9d433592" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/75c68712e8d349e286b054753978c26c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Here, docker ps output name, image used, command, uptime and port info.</span></span></p></div><div id="https://www.notion.so/6d27d334fad54aebaa56f52d3aa618ab" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">To limit column displayed, —format &#x27;_pattern&#x27;</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/276406b5bcad43c8bcc26e12c25d7fa4" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Print name and Image</span></span></li></ul><pre id="https://www.notion.so/026f06b1021c40fd9f715b13b3a54c6b" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># print in single line</span>
docker <span class="token function">ps</span> --format <span class="token string">'{{.Name}} container is using {{.Imgae}} image'</span>
<span class="token comment"># print in table format</span>
docker <span class="token function">ps</span> --format <span class="token string">'table {{.Name}}<span class="token entity" title="\t">\t</span>{{.Image}}'</span>

<span class="token comment"># print all ip addr for running container</span>
docker <span class="token function">ps</span> -q <span class="token operator">|</span> <span class="token function">xargs</span> docker inspect --format <span class="token string">'{{ .Id }} - {{ .Name }} - {{ .NetworkSettings.IPAddress }}'</span></span></span></span></code></pre><div id="https://www.notion.so/3f6d1375b3094f538940a9ddde898183" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fbe90bbee-775e-4f6d-a2be-aa8b01726110%2FUntitled.png?width=984&amp;table=block&amp;id=3f6d1375-b309-4f53-8940-a9ddde898183"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fbe90bbee-775e-4f6d-a2be-aa8b01726110%2FUntitled.png?width=984&amp;table=block&amp;id=3f6d1375-b309-4f53-8940-a9ddde898183" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/97d1f361a462495fb80ac25142f4d27f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">(source : </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://docs.docker.com/engine/reference/commandline/ps/">https://docs.docker.com/engine/reference/commandline/ps/</a></span><span class="SemanticString"> )</span></span></p></div><div id="https://www.notion.so/fc8ebd503de54b14a9d83e4569614f62" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><h2 id="https://www.notion.so/0ab9ad68f56b40b0a0fd2f13512d9a97" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/0ab9ad68f56b40b0a0fd2f13512d9a97"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Rootless Docker</span></span></h2><div id="https://www.notion.so/36284d67cbb040b39d7f7b9042c6060f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Rootless Docker is a project from Docker that removes the requirement for the Docker Daemon to be started by a root. This creates a more secure environment.</span></span></p></div><h1 id="https://www.notion.so/513fed3f514b49f0b0c803b596d1d33d" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/513fed3f514b49f0b0c803b596d1d33d"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Swarm mode</span></span></h1><div id="https://www.notion.so/63f028684e6941188866b6ffd960778a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">It enables ability to deploy container across multiple Docker hosts, using overlay network for service discovery with build-in load balancer.</span></span></p></div><div id="https://www.notion.so/9b7e0d45c8694054bade673fd7328b59" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Concepts :</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/6614de7fbe6c481f9b0f745b0502e3e3" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Node </strong></span><span class="SemanticString">: instance of docker engine connected to swarm. Nodes are either workers or managers. Manager schedule which container to run where and workers execute the task.</span></span></li><li id="https://www.notion.so/d2401ff197274555aa8f7b286321a21a" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Services </strong></span><span class="SemanticString">: collection of tasks executed by workers.</span></span></li><li id="https://www.notion.so/7ae5214cc01d4cc9b67f2509c1e93955" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Load balancing</strong></span><span class="SemanticString"> : load balancer to process requests across all container in service.  </span></span></li></ul><h3 id="https://www.notion.so/297cab0f6a024d01a26fe62c0b7eb505" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/297cab0f6a024d01a26fe62c0b7eb505"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Step 1: Initialise Swarm mode</span></span></h3><div id="https://www.notion.so/77cfdefb4a934e648d0deb9adb7c1efa" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">After it Docker becomes manages by default, i.e. first node to initialize. New nodes join the cluster, they adjust their role between manager and workers.</span></span></p></div><pre id="https://www.notion.so/2bc1f5f8ae324f4a859fb66a4baa4a6c" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># Initialise Swarm mode, it'll output init token which used to add additional nodes.</span>
docker swarm init</span></span></span></code></pre><h3 id="https://www.notion.so/3ecb93b705764f3cb9e2ae2303e2c91f" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/3ecb93b705764f3cb9e2ae2303e2c91f"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Step 2: Join Cluster</span></span></h3><div id="https://www.notion.so/8979c6020ed348f89d6a5d64125e02bf" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Joining is done by pointing other host to current manager of cluster.</span></span></p></div><div id="https://www.notion.so/e080871b12184cff8ec0bba1b0f6854c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Docker uses port 2377 for swarm managing.</span></span></p></div><div id="https://www.notion.so/5d015c85bab0401ab6d62d9b5b420d23" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">On second host,</span></span></p></div><pre id="https://www.notion.so/44d30657d8ed4ea0bd795b217a8bff9e" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># first task to obtain token is to add worker to cluster</span>
<span class="token comment"># here we ask manager what's the token via `swarm join-token`</span>
<span class="token assign-left variable">token</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">ssh</span> -o <span class="token assign-left variable">StrictHostKeyChecking</span><span class="token operator">=</span>no <span class="token number">172.17</span>.0.77 <span class="token string">"docker swarm join-token -q worker"</span><span class="token variable">)</span></span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">echo</span> <span class="token variable">$token</span>
<span class="token comment"># join the requesting access</span>
docker swarm <span class="token function">join</span> <span class="token number">172.17</span>.0.77:2377 --token <span class="token variable">$token</span>
<span class="token comment"># view nodes in cluster</span>
docker node <span class="token function">ls</span></span></span></span></code></pre><h3 id="https://www.notion.so/10a417c9c7384ad5b7cae3eada40f8f4" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/10a417c9c7384ad5b7cae3eada40f8f4"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Step 3: Create overlay network</span></span></h3><div id="https://www.notion.so/dab689690975486c9650ec2c410c1efd" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">The overlay network used to enable containers on diff hosts to communicate, this is Virtual Extensible LAN (VXLAN)</span></span></p></div><pre id="https://www.notion.so/e84be9dea97b45298a649a6be40e5f47" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># create new overlay network called skynet, all container registered to this node can communicate with each other</span>
docker network create -d overlay skynet</span></span></span></code></pre><h3 id="https://www.notion.so/3d2f02155cf84472b56b517eba7e4e05" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/3d2f02155cf84472b56b517eba7e4e05"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Step 4: Deploy service</span></span></h3><div id="https://www.notion.so/57cd8c68a3bf48d4bf1fbcd3f2b5a56c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Services used to run containers across the cluster, it allows to define how applications deployed at scale.</span></span></p></div><pre id="https://www.notion.so/539e9a6121a446bd8777441df7e48339" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># to ensure availablity, we run two replicas</span>
docker <span class="token function">service</span> create --name http --network skynet --replicas <span class="token number">2</span> -p <span class="token number">80</span>:80 docker-http-service
<span class="token comment"># view running service</span>
docker <span class="token function">service</span> <span class="token function">ls</span></span></span></span></code></pre><h3 id="https://www.notion.so/58b9d4873f91433d88710e9b0edf95ce" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/58b9d4873f91433d88710e9b0edf95ce"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Step 5: Inspect State</span></span></h3><div id="https://www.notion.so/1b64cee45e2f4a53ab2175eb297bfe02" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Inspect health and state of cluster and running applications.</span></span></p></div><pre id="https://www.notion.so/4295a001c3284982a9f7d47ef0d5d94d" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># view list of task with service across the cluster</span>
docker <span class="token function">service</span> <span class="token function">ps</span> http
<span class="token comment"># view details and config of service</span>
docker <span class="token function">service</span> inspect --pretty http
<span class="token comment"># on each node, self refers to manager node</span>
docker node <span class="token function">ps</span> self</span></span></span></code></pre><h3 id="https://www.notion.so/a8f8fe70cfe645708bce0af682dfbafc" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/a8f8fe70cfe645708bce0af682dfbafc"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Step 6: Scale service</span></span></h3><div id="https://www.notion.so/6d340b48291849ae8d80892fa94a6767" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Service allows to scale many instances of running task across the cluster.</span></span></p></div><pre id="https://www.notion.so/9fa42c62544546c3af754ef37c053347" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># scale http service to running across five contianer</span>
docker <span class="token function">service</span> scale <span class="token assign-left variable">http</span><span class="token operator">=</span><span class="token number">5</span> </span></span></span></code></pre></article>  <footer class="Footer">
        <div>&copy; Vizlog 2021</div>
        <div>&centerdot;</div>
        <div>Powered by <a href="https://github.com/dragonman225/notablog" target="_blank"
            rel="noopener noreferrer">Notablog</a>.
        </div>
    </footer>
</body>

</html>
