<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Primary Meta Tags -->
  <title>Vizlog</title>
  <meta name="title" content="Vizlog">
  <meta name="description" content="Collection of unusual experiments and Ethical hacking notes">

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="http://vshalson.tech/">
  <meta property="og:title" content="Vizlog">
  <meta property="og:description" content="Collection of unusual experiments and Ethical hacking notes">
  <meta property="og:image" content="">

  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content="http://vshalson.tech/">
  <meta property="twitter:title" content="Vizlog">
  <meta property="twitter:description" content="Collection of unusual experiments and Ethical hacking notes">
  <meta property="twitter:image" content="">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- iOS Safari -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <!-- Chrome, Firefox OS and Opera Status Bar Color -->
  <meta name="theme-color" content="#FFFFFF">
  <meta property="og:title" content="KataCoda : Docker Foundations">
    <meta name="description" content="Documenting Katacoda learnings">
  <meta property="og:description" content="Documenting Katacoda learnings">
    <!-- following viz change -->
    <meta property="og:type" content="blog">
  <title>KataCoda : Docker Foundations</title>
  <!-- Favicon -->
    <link rel="shortcut icon" href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fb71620e3-c96f-4528-8d97-b288c190e643%2FRengoku_kyoujurou_(kimetsu_no_yaiba).jpeg?table=collection&id=aa0c780e-41b0-4b41-8887-fe12b1fd89a1">
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css">
  <link rel="stylesheet" type="text/css"
    href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.19.0/themes/prism.min.css">
  <link rel="stylesheet" type="text/css" href="css/SourceSansPro.css">
  <link rel="stylesheet" type="text/css" href="css/notablog.css">
  <link rel="stylesheet" type="text/css" href="css/theme.css">
  <style>
    :root {
      font-size: 18px;
    }

    .DateTagBar {
      margin-top: 1.0rem;
    }
  </style>
</head>

<body>
  <nav class="Navbar">
    <a href="index.html">
      <div class="Navbar__Btn"><span><img class="inline-img-icon" src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fb71620e3-c96f-4528-8d97-b288c190e643%2FRengoku_kyoujurou_(kimetsu_no_yaiba).jpeg?table=collection&id=aa0c780e-41b0-4b41-8887-fe12b1fd89a1"></span> <span>Home</span></div>
    </a>
                    <span class="Navbar__Delim">&centerdot;</span>
    <a href="about.html">
      <div class="Navbar__Btn"><span><img class="inline-img-icon" src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fb0876588-8392-4afd-88f2-2b79f1fa471b%2FTwitter.jpeg?table=block&id=b68b89e0-6eee-410d-b5c3-4ed36f459df0"></span> <span>You don't know me?</span></div>
    </a>
                                                                                          </nav>
  <header class="Header">
          <div class="Header__Spacer Header__Spacer--NoCover">
    </div>
        <div class="Header__Icon"><span>⏱️</span></div>
        <h1 class="Header__Title">KataCoda : Docker Foundations</h1>
            <div class="DateTagBar">
                          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--orange">
            <a href="tag/Docker.html">Docker</a>
          </span>
                  </div>
          </header>
      <article id="https://www.notion.so/1df4b6916d034aa6bdd79517b86d4351" class="PageRoot"><div id="https://www.notion.so/ea557e796b96461193d3e83d1755b208" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Container are Linux process.</span></span></p></div><pre id="https://www.notion.so/25fe723a0b804a51a2741193629d8cec" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment">#Launching Redis contianer</span>
docker run -d --name<span class="token operator">=</span>db redis:alpine
<span class="token comment">#Check  Process ID and Prent Process ID</span>
docker <span class="token function">top</span> db
<span class="token comment"># To list sub process use `Pstree`</span>
pstree -c -p -A <span class="token variable"><span class="token variable">$(</span>pgrep dockerd<span class="token variable">)</span></span></span></span></span></code></pre><div id="https://www.notion.so/c81e9d53cad54cf4ab1ad0cbd17d9344" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Configuration of each process define in /proc dir.</span></span></p></div><blockquote id="https://www.notion.so/a48494cfba4e4a51880f5c79f5742df4" class="ColorfulBlock ColorfulBlock--BgPink Quote"><span class="SemanticStringArray"><span class="SemanticString">Give me process ID, I&#x27;ll give you config dir.
- /proc</span></span></blockquote><pre id="https://www.notion.so/092ea34787304ae88df467e3d9fe17b3" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token assign-left variable">DBPID</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>pgrep redis-server<span class="token variable">)</span></span>
<span class="token builtin class-name">echo</span> REDIS is <span class="token variable">$DBPID</span>
<span class="token comment">#here DBPID variable to get Process ID of running redis-server process</span>
<span class="token function">ls</span> /proc
And
<span class="token function">ls</span> /proc/<span class="token variable">$DBPID</span></span></span></span></code></pre><div id="https://www.notion.so/f4f9be40f2664671a64a48a2b2f5cbe9" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/2939a80980d647e7ab64f1ddf7c23450" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Namespaces</strong></span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/1ffe795106bd41fc850344215b8b9488" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Is to limit what process can see and access certain parts of system</span></span></li><li id="https://www.notion.so/16b5eb188bde4b2c82d27ca76f379fe9" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">When container started, Docker runtime will create new namespaces to sandbox the process. By running the process in it&#x27;s own PID namespace.</span></span><div id="https://www.notion.so/b5759b36a0294c67b8a0bd319bb5d5a8" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://en.wikipedia.org/wiki/Linux_namespaces">https://en.wikipedia.org/wiki/Linux_namespaces</a></span></span></p></div><div id="https://www.notion.so/f8a26e08f71a4ccd82e8d3af04a3c653" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Available Namespace:</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/8753ec505f3d4671b4fcde5aa92757bf" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Mount - mnt</span></span></li><li id="https://www.notion.so/31aa9f1f26f14cb297094bd4702409dd" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Network - net</span></span></li><li id="https://www.notion.so/e38c559e6ea942af8b6a9988f3f9be67" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Process ID - pid</span></span></li><li id="https://www.notion.so/2c424f56f90149f8b1b6a76a36a9ce6b" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Control groups - cgroup</span></span></li><li id="https://www.notion.so/89c76f3bd79c4057aca71995b84c56c2" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">UTS - hostnames</span></span></li></ul></li></ul><div id="https://www.notion.so/fa648c177fed4a8c98a072bc853122ae" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/fb77e0a773474fe8ae7f1e17da12a16c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Unshare  : to launch &quot;contained process&quot;, unshared from parent</strong></span></span></p><div class="Text__Children"><div id="https://www.notion.so/4fccf1a105ee4cb38e10c60d202f44b6" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Without using docker runtime, process can still have it&#x27;s own namespace.</span></span></p></div><pre id="https://www.notion.so/81bd85c8d13a4b60ac2a88b10b9d0c2e" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>unshare --help</span></span></span></code></pre><div id="https://www.notion.so/b49218a640b14922a44f4cb09536a312" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Aha, run bash prompt process seprately</span></span></p></div><pre id="https://www.notion.so/b9eac858b7d140b093b271b4748cb0fa" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token function">sudo</span> unshare --fork --pid --mount-prac <span class="token function">bash</span>
<span class="token function">ps</span>
<span class="token punctuation">..</span> <span class="token builtin class-name">continue</span> experimenting your shit
<span class="token builtin class-name">exit</span></span></span></span></code></pre></div></div><div id="https://www.notion.so/26e20c8009084ef1a018420bebdead95" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">What happens when we share a namespace?</span></span></p></div><div id="https://www.notion.so/2edd48e7e19247a7944bd983459e5235" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">It allows for process to reused the same namespace,allow to view and interact.</span></span></p></div><div id="https://www.notion.so/781b8134e5be4c9ca607b75bf59c09e2" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F2dcb17ac-42b2-4b4b-b662-73e1f8fac683%2FUntitled.png?width=658&amp;table=block&amp;id=781b8134-e5be-4c9c-a607-b75bf59c09e2"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F2dcb17ac-42b2-4b4b-b662-73e1f8fac683%2FUntitled.png?width=658&amp;table=block&amp;id=781b8134-e5be-4c9c-a607-b75bf59c09e2" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/67f7bd8c4cad4b4bb7ae2b86e628f3e7" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">NSEnter</strong></span><span class="SemanticString"> : to attach process to existing Namespace (used for debugging)</span></span></p></div><pre id="https://www.notion.so/ac243b517e5e49c6b79be8439de29b8d" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>nsenter --target <span class="token variable">$DBPID</span> --mount --uts --ipc --net --pid <span class="token function">ps</span> aux
<span class="token comment"># target process </span></span></span></span></code></pre><div id="https://www.notion.so/fbca75a70385416f98d59314e1282b1d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Using Docker, we can share namespaces </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">container:&lt;container_name&gt;</code></span><span class="SemanticString">    </span></span></p><div class="Text__Children"><div id="https://www.notion.so/7480cb1ebe0a4f1aa12c47cbcae5d2c5" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Connect ngix to DB namespace</span></span></p></div><div id="https://www.notion.so/c6db3e01d9c84423ac30dbb87734fd23" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fb3058904-70a3-44d3-b3b1-5ee34695baec%2FUntitled.png?width=659&amp;table=block&amp;id=c6db3e01-d9c8-4423-ac30-dbb87734fd23"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fb3058904-70a3-44d3-b3b1-5ee34695baec%2FUntitled.png?width=659&amp;table=block&amp;id=c6db3e01-d9c8-4423-ac30-dbb87734fd23" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/a9c55683f7f74691be82b0e3b1a17e12" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Make variable, WEBPID </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">WEBPID=$(pgre nginx | tail -n1)</code></span></span></p></div><div id="https://www.notion.so/bddbfa5a05bd47ebae652b1d89041d4b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Namespace for both process points to same location.</span></span></p></div></div></div><div id="https://www.notion.so/a1fe06e75ce9458694baf7ff0464f911" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/e8d6fb62fd6a4aa7afd122c5e4e46ab0" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Control groups (Cgroups) : limit amout of resources a process can consume.</span></span></p></div><pre id="https://www.notion.so/48a60addbc974ab69d9cfc15a594e5b0" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># CHeck cgroup mapping</span>
<span class="token function">cat</span> /proc/<span class="token variable">$DBPID</span>/cgroup
<span class="token comment"># Check CPU stats for process</span>
<span class="token function">cat</span> /sys/fs/cgroup/cpu,cpuacct/docker/<span class="token variable">$DBID</span>/cpuacct.stat
<span class="token comment"># CHeck CPU share limit</span>
<span class="token function">cat</span> /sys/fs/cgroup/cpu,cpuacct/docker/<span class="token variable">$DBID</span>/cpuacct.shares

Dcoker Cgroup stored @ /sys/fs/cgroup/memory/docker/</span></span></span></code></pre><div id="https://www.notion.so/7a10f867e121480790ed3622bcae8c6a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Docker can control memory limits via Cgroup settings.</span></span></p><div class="Text__Children"><div id="https://www.notion.so/622dc4432713415e890ede5a94b46b71" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">By default, container have no limit on memory.</span></span></p></div><pre id="https://www.notion.so/e28f692a9da340469a7fa3f576c6e576" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>docker stats <span class="token operator">&lt;</span>container_name<span class="token operator">></span> --no-stream</span></span></span></code></pre><div id="https://www.notion.so/ce340e46737f46f5a32fb5df295ee122" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">To set limits,</span></span></p></div><pre id="https://www.notion.so/f49cd74d24874d618c250892a9661e17" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token builtin class-name">echo</span> <span class="token number">8000000</span> <span class="token operator">></span> /sys/fs/cgroup/memory/docker/<span class="token variable">$DBID</span>/memory.limit_in_bytes
Here <span class="token number">8000000</span> <span class="token keyword">in</span> bytes to <span class="token number">7.629</span> mibibyte</span></span></span></code></pre></div></div><div id="https://www.notion.so/d70e0908cb864cf2a254493234080e4b" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F81178178-b50e-4e74-bea7-9758e0440277%2FUntitled.png?width=1222&amp;table=block&amp;id=d70e0908-cb86-4cf2-a254-493234080e4b"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F81178178-b50e-4e74-bea7-9758e0440277%2FUntitled.png?width=1222&amp;table=block&amp;id=d70e0908-cb86-4cf2-a254-493234080e4b" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/53b69f0a797f43468255ff2c8c07ecf6" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/6fc53ca603b9489dbfa2b443dd7d6ee6" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/badabeee85774d0881b937b8d70abf36" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">AppArmor</strong></span></span></p><div class="Text__Children"><div id="https://www.notion.so/ebae56f5b7524a94b5e06f3d1fbaa3a1" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">All actions with Linux done via syscalls.</span></span></p></div><div id="https://www.notion.so/af1443f3b71b4f8eab8ff71b6fffe268" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Kernel has 330 syscalls to perform operations.</span></span></p></div><div id="https://www.notion.so/5203aa6d9e21404baf5b0e7be5ffb117" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">All applications use combination of syscalls to perform required operatn.</span></span></p></div><div id="https://www.notion.so/71e7c04ec4554d55a90f2502e5d0ca4e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">AppArmor is a application defined profile that describes which parts of the system a process can access.</strong></span></span></p></div></div></div><div id="https://www.notion.so/d6d011a05149417eb4b20f103939648e" class="Divider"></div><div id="https://www.notion.so/eda1c36052194c8f9fbf64149dc41931" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><h2 id="https://www.notion.so/9e74f9da43e744698fab38876f6ef042" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/9e74f9da43e744698fab38876f6ef042"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Scenario : 2</span></span></h2><div id="https://www.notion.so/6c02dd22deeb4e09a2c0f3a902a110f0" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Container image: container image is tar file containing tar files. Each tar file is layer. Once all tar file extract into same location then you have container&#x27;s filesystem.</span></span></p></div><div id="https://www.notion.so/e69f734a09ec4a19a92f31582231df77" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Feed561f9-77bb-40b1-a924-87c2e7e233ca%2FUntitled.png?width=781&amp;table=block&amp;id=e69f734a-09ec-4a19-a92f-31582231df77"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Feed561f9-77bb-40b1-a924-87c2e7e233ca%2FUntitled.png?width=781&amp;table=block&amp;id=e69f734a-09ec-4a19-a92f-31582231df77" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/2db99bb0592a4dc0986f3607feeb28fd" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Image also includes meta deta about version info and tag name.</span></span></p></div><div id="https://www.notion.so/74dae127db4042cbb28af33b766c27bc" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F7e70f63f-82b4-4e03-ad13-fed77eb792be%2FUntitled.png?width=747&amp;table=block&amp;id=74dae127-db40-42cb-b28a-f33b766c27bc"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F7e70f63f-82b4-4e03-ad13-fed77eb792be%2FUntitled.png?width=747&amp;table=block&amp;id=74dae127-db40-42cb-b28a-f33b766c27bc" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/2c66120aadb44e5687462e71d2452c83" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">And extract it further,</span></span></p></div><div id="https://www.notion.so/747bba209ee04816a771f2ec92524190" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fcfaef57e-3ad0-402f-807c-e2526adf0e3e%2FUntitled.png?width=819&amp;table=block&amp;id=747bba20-9ee0-4816-a771-f2ec92524190"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fcfaef57e-3ad0-402f-807c-e2526adf0e3e%2FUntitled.png?width=819&amp;table=block&amp;id=747bba20-9ee0-4816-a771-f2ec92524190" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/f92d24cf8d9d48f9b97c75050281a3e3" class="Divider"></div><div id="https://www.notion.so/96810433605e4e38b2152b08760c6570" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/ae7b1c7cac37446f849690344a02c6a0" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Create image with dockerfile</strong></span></span></p><div class="Text__Children"><div id="https://www.notion.so/9f9c6d181c6544f2bc2230e4953ef1fe" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Import tar file to create an image from scratch.</span></span></p></div><div id="https://www.notion.so/06dbdc12682443f1972a99c10fa6f8b7" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Here busybox (package with standard unix programs) as base.</span></span></p></div></div></div><pre id="https://www.notion.so/24d2fea663b44ed0893dd519815ea5f3" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># Download and extract busybox rootfs</span>
<span class="token function">curl</span> -LO https://raw.githubusercontent.com/moby/moby/a575b0b1384b2ba89b79cbd7e770fbeb616758b3/contrib/mkimage/busybox-static <span class="token operator">&amp;&amp;</span> <span class="token function">chmod</span> +x busybox-static
<span class="token comment"># To download rootfs and main binaries </span>
./busybox-static busybox
<span class="token comment"># create a file</span>
<span class="token builtin class-name">echo</span> KatacodaPrivateBuild <span class="token operator">></span> busybox/release
<span class="token comment"># dir can into tar and import into docker as an image.</span>
<span class="token function">tar</span> -C busybox -c <span class="token builtin class-name">.</span> <span class="token operator">|</span> docker <span class="token function">import</span> - busybox
<span class="token comment"># launch as container, here to print release</span>
docker run busybox <span class="token function">cat</span> /release</span></span></span></code></pre><div id="https://www.notion.so/59bd6b49f75d455aaa49b8f424a07e9f" class="Divider"></div><h1 id="https://www.notion.so/1702dbced537469990c9276d0dfcf689" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/1702dbced537469990c9276d0dfcf689"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Docker foundations</span></span></h1><h3 id="https://www.notion.so/77a899acd337449c85e4eede689530dd" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/77a899acd337449c85e4eede689530dd"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Deploy first Docker Container</span></span></h3><pre id="https://www.notion.so/44bb2e7433d94bb5900dc6bfb246f160" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># search docker image</span>
docker search redis

<span class="token comment"># Run command in foreground</span>
docker run -d redis
<span class="token number">555555</span></span></span></span></code></pre><div id="https://www.notion.so/f7a55ad07ab848368a724387a00c5b91" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><h2 id="https://www.notion.so/4c2ec6b0436f4a1490d18deb9710ac03" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/4c2ec6b0436f4a1490d18deb9710ac03"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Deploy Static HTML Website as Container</span></span></h2><ul class="BulletedListWrapper"><li id="https://www.notion.so/9a3b5577755840dc94ecdcc2e2c2fa5b" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Create Dockerfile</span></span><ul class="BulletedListWrapper"><li id="https://www.notion.so/3dbd9dd3663b40098d6dfa958b470443" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Docker Images start from a base image.</span></span></li><li id="https://www.notion.so/9a96ccd07d35456b9495e0063f0facc0" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Base image is defined as instruction in Dockerfile.</span></span></li></ul></li><li id="https://www.notion.so/b4db793f910446a1848fb58443aab46b" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Build Docker Image</span></span><ul class="BulletedListWrapper"><li id="https://www.notion.so/d51d811b02db48908eff0153ef625be8" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Build command takes in some diff parameters.</span></span></li></ul><pre id="https://www.notion.so/a4dbc648d8a44e168adf1b69b3513f14" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># Build our static HTML</span>
docker build -t webserver-image:v1 <span class="token builtin class-name">.</span></span></span></span></code></pre></li><li id="https://www.notion.so/a5d3491b33144d2ea31e6535a0d38086" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Run </span></span><ul class="BulletedListWrapper"><li id="https://www.notion.so/7508164d4c594ac0b1d310df05be907e" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">When container launches, it&#x27;s sandboxed from other processes and networks on the host.</span></span></li></ul><pre id="https://www.notion.so/7cb35323d10c45c6bde5c0ede9364357" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>docker run -d -p <span class="token number">80</span>:80 webserver-image:v1
	-d <span class="token builtin class-name">:</span> run <span class="token keyword">in</span> background
	-p <span class="token builtin class-name">:</span> <span class="token builtin class-name">bind</span> port</span></span></span></code></pre></li></ul><div id="https://www.notion.so/31ce8218b874405aabbe12f3dc9bfaf7" class="Divider"></div><h3 id="https://www.notion.so/b13ac6e4df9f4fbd9eed46bef4345f9b" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/b13ac6e4df9f4fbd9eed46bef4345f9b"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Optimise Dockerfile with OnBuild</span></span></h3><div id="https://www.notion.so/b70fea73249243acac4e0576ad0fb7c3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Dockerfile executes in order from top to bottom, one can trigger instruction to execute later time when image is used as base for another image.</span></span></p></div><div id="https://www.notion.so/1735a89ae91240da9d33db7bedfbb3e2" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F13addfcf-0d6c-4527-9521-c10f91565282%2FUntitled.png?width=582&amp;table=block&amp;id=1735a89a-e912-40da-9d33-db7bedfbb3e2"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F13addfcf-0d6c-4527-9521-c10f91565282%2FUntitled.png?width=582&amp;table=block&amp;id=1735a89a-e912-40da-9d33-db7bedfbb3e2" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/5ec9cbf03e334975a8bdabca9f45d038" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">(Image Source: </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://katacoda.com/courses/docker/4">https://katacoda.com/courses/docker/4</a></span><span class="SemanticString"> )</span></span></p></div><div id="https://www.notion.so/d37816bfc86048849aaa9029d06f4795" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Application Dockerfile</span></span></p></div><div id="https://www.notion.so/d4893264ddff4ea8af3bb14d86970fd6" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F8f352165-c254-4c7f-a384-a42cc70de843%2FUntitled.png?width=592&amp;table=block&amp;id=d4893264-ddff-4ea8-af3b-b14d86970fd6"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F8f352165-c254-4c7f-a384-a42cc70de843%2FUntitled.png?width=592&amp;table=block&amp;id=d4893264-ddff-4ea8-af3b-b14d86970fd6" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/d9520b2d6901490b9d68986ac6d7f18d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/1cf9b0d51d2646ad822f7434ab910ecc" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Just like we have .gitignore, to prevent files or dir from include by mistake in images.</span></span></p></div><blockquote id="https://www.notion.so/ae06dab082714b6caab501de9b346808" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString">If you need to use the passwords as part of a </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">RUN</strong></span><span class="SemanticString"> command then you need to copy, execute and delete the files as part of </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">a single RUN command</strong></span><span class="SemanticString">. Only the final state of the Docker container is persisted inside the image.</span></span></blockquote><div id="https://www.notion.so/e8b9654a92aa4ee699fa0ec9290c3801" class="Divider"></div><h2 id="https://www.notion.so/da5f8e8f70c0416daac01eb8c9fd3970" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/da5f8e8f70c0416daac01eb8c9fd3970"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Data container</span></span></h2><div id="https://www.notion.so/1bc01418a9c64f20b41f2022d5c64f86" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Responsible to be place to store or manage data.</span></span></p></div><div id="https://www.notion.so/85d605bc9746453e8341ab5fef4958a4" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">It&#x27;s managed by host system but don&#x27;t run on </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">docker ps</code></span></span></p></div><div id="https://www.notion.so/e677eed3063d470388600bd885fdcfaf" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Scenario: </span></span></p></div><pre id="https://www.notion.so/003f1ffc9b5a43718d3717e316b4520d" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># Create data container for storing config files using</span>
docker create -v /config --name dataContainer busybox

<span class="token comment"># COpy file using cp, here copy config.conf to dataContainer</span>
docker <span class="token function">cp</span> config.conf dataContainer:/config/

<span class="token comment"># Mount using --volumes-from</span>
docker run --volumes-from dataContainer ubuntu <span class="token function">ls</span> /config

<span class="token comment"># Export/Import Containers, move to another machine</span>
docker <span class="token builtin class-name">export</span> dataContainer <span class="token operator">></span> dataContainer.tar
docker <span class="token function">import</span> dataContainer.tar</span></span></span></code></pre><div id="https://www.notion.so/3de982dd4f2942a1b351783cec5a4ea6" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Here, DataContainer has our config file, we reference the container when we launch depended container here ubuntu one.</span></span></p></div><h2 id="https://www.notion.so/90f41cbe930e4eb8a22bd3d7b38e2771" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/90f41cbe930e4eb8a22bd3d7b38e2771"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Communicating between Containers</span></span></h2><div id="https://www.notion.so/b40b4458bbbf404eb543c4f55bb75623" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Define friendly name container you&#x27;re connecting to.</span></span></p></div><div id="https://www.notion.so/2a3500b291c1414faf2dd52b32c3bb5d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Scenario:</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/af7015eaaefa44dca4475b2edce7043a" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Start Data store with friendly name</span></span><pre id="https://www.notion.so/25d593e78515401fb646e9396f6c80f8" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>docker run -d --name redis-server redis</span></span></span></code></pre></li><li id="https://www.notion.so/3a436de0050f4581be5ccc09088b6b9f" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">When link created, Docker will do</span></span><div id="https://www.notion.so/7025824de3dd42f684be3498a5263013" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">The link updates /etc/hosts and environment variables to allow containers to discover and communicate</span></span></p></div><pre id="https://www.notion.so/1c2fc960c18a48639ebbd3084b8ad0b7" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># output env variable with env command</span>
docker run --link redis-server:redis alpine <span class="token function">env</span>

<span class="token comment"># It will update HOSTS file wiht entry for source container for source container with three names, the **original**, the **alias** and **hash-id.**</span>
<span class="token comment"># output container host entry</span>
docker run --link redis-server:redis alpine <span class="token function">cat</span> /etc/hostss</span></span></span></code></pre></li><li id="https://www.notion.so/ed5697aa151349729945d50a81c8acb7" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Connect to App, applications can connect and communicate with source container in usual way.</span></span></li></ul><pre id="https://www.notion.so/8d4cd569838240fb8d6b90326c398fec" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>docker run -d -p <span class="token number">3000</span>:3000 --link redis-server:redis katacoda/redis-node-docker-example</span></span></span></code></pre><h2 id="https://www.notion.so/7f810be378b64d1db4aef19816b24883" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/7f810be378b64d1db4aef19816b24883"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Docker network</span></span></h2><div id="https://www.notion.so/39c4d135a3634f9491466bb32b4a9712" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Similar to physical network, allow container to come and go more freely than using links.</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/89bf909d31b24142807a380c8b07eaed" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Create Network</span></span><div id="https://www.notion.so/106da6fca63f4c3bbed9a234494a5708" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Network allow us to attach multiple containers which able to discover each other.</span></span></p></div><pre id="https://www.notion.so/17c0a6342159457c962ee3353ff2dd2d" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># create network with predefined name</span>
docker network create backend-network

<span class="token comment"># launch new container, --net flag to assign network</span>
docker run -d --name<span class="token operator">=</span>redis --net<span class="token operator">=</span>backend-network redis</span></span></span></code></pre></li><li id="https://www.notion.so/2b27c1f6e1b444f180a35daf8f1f3293" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Network Communication</span></span><div id="https://www.notion.so/526508e4555945819ff75eb7a93317f3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Here Docker not assigns env variables or updates host file of containers.</span></span></p></div><div id="https://www.notion.so/04796edb9d0f405bac75678176d2ef28" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Instead, container communicate via Embedded DNS server in Docker. DNS assign to all container via IP 127.0.0.11 and set </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">resolve.conf</code></span><span class="SemanticString"> file.</span></span></p></div><div id="https://www.notion.so/e181c39440de4377bcb78dd6805ae03a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">When containers try access other container via well-known name, as Redis, DNS server will return IP addr of correct container.</span></span></p></div><pre id="https://www.notion.so/1a0622113efa4b91abab5f4b96fb28d1" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>docker run --net<span class="token operator">=</span>backend-network alpine <span class="token function">ping</span> -c1 redis</span></span></span></code></pre></li><li id="https://www.notion.so/ac3d1da18d6548f9969491fac1618d65" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Connect Two containers</span></span><div id="https://www.notion.so/7bcaa78da6b74cdb91a9f10c276f02aa" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Docker supports multiple network and container being attached to more than one network at same time.</span></span></p></div><pre id="https://www.notion.so/3a12fbd0b6bd46d598ddca8005e9f180" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># create network</span>
docker network create frontend-network

<span class="token comment"># connect command to attach existing container</span>
docker network connect frontend-network redis

<span class="token comment"># launch web-server, it'll communicate with redis instance</span>
docker run -d -p <span class="token number">3000</span>:3000 --net<span class="token operator">=</span>frontend-network katacoda/redis-node-docker-example</span></span></span></code></pre></li><li id="https://www.notion.so/177ef8d16e2d4b239929ca41db20a41e" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Disconnect Container</span></span><pre id="https://www.notion.so/d5a81775c8ef421c80cd56caac73e27b" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># list networks on host</span>
docker network <span class="token function">ls</span>

<span class="token comment"># explore network to see containers attach and their IP addr</span>
docker network inspect frontend-network

<span class="token comment"># disconnect redis container from frontend-network</span>
docker network disconnect frontend-network redis</span></span></span></code></pre></li></ul><div id="https://www.notion.so/6a34e3bd373c4ff3a46ca93440f2b9d4" class="Divider"></div><h2 id="https://www.notion.so/f2bb6fda7bd34f5cad920333dbaecc93" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/f2bb6fda7bd34f5cad920333dbaecc93"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Persisting Data using Volumes</span></span></h2><pre id="https://www.notion.so/87107f3721c24d68b0d6f74f5ca63bd0" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># Starting redis container, -v : create data volume.</span>
docker run -v /docker/redis-data:/data --name r1 -d redis <span class="token punctuation">\</span>
	redis-server --appendonly <span class="token function">yes</span>

<span class="token comment"># Pipe data into redis instance using </span>
<span class="token function">cat</span> data <span class="token operator">|</span> docker <span class="token builtin class-name">exec</span> -i r1 redis-cli --pipe

<span class="token comment"># Same dir can be mounted to second container, here for backup operation</span>
docker run -v /docker/redis-data:/backup ubuntu <span class="token function">ls</span> /backup

<span class="token comment"># --volumes-from : maps the mapped volume from source to container being launched</span>
docker run --volumes-from r1 -it ubuntu <span class="token function">ls</span> /data

<span class="token comment"># Mounting container can be prone to write, here specify read-only `:ro`</span>
docker run -v /docker/redis-data:/data:ro -it ubuntu <span class="token function">rm</span> -rf /data</span></span></span></code></pre><div id="https://www.notion.so/826dd855b44e4f8baace567c81e216f1" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><h2 id="https://www.notion.so/8c78cdbedfc149b4986d3d3c305557f1" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/8c78cdbedfc149b4986d3d3c305557f1"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Managing Log Files</span></span></h2><div id="https://www.notion.so/723bb8db563a42e597244f2d5da88bb5" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Docker will track standard out and standard error output</span></span></p></div><pre id="https://www.notion.so/59f44c5b77734cd8bd5ec14b5d9b369e" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># to retrieve logs</span>
docker logs redis-server</span></span></span></code></pre><div id="https://www.notion.so/2bed45edeaaa440f833aa68f4bf5e4cb" class="ColorfulBlock ColorfulBlock--BgBlue Callout"><div class="Callout__Icon"><div class="Icon">🧭</div></div><p class="Callout__Content"><span class="SemanticStringArray"><span class="SemanticString">syslog is a widely used standard for message logging. It permits separation of the software that generates messages, the system that stores them, and the software that reports and analyses them</span></span></p></div><pre id="https://www.notion.so/a917ffd60ebe483d9ed55335b846f5b3" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># command to redirect redis logs to syslog</span>
docker run -d --name redis-syslog --log-driver<span class="token operator">=</span>syslog redis

<span class="token comment"># Docker inspect to identify logging config for particular container</span>
$ docker inspect --format <span class="token string">'{{ .HostConfig.LogConfig }}'</span> redis-server
<span class="token punctuation">{</span>json-file map<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
$ docker inspect --format <span class="token string">'{{ .HostConfig.LogConfig }}'</span> redis-syslog
<span class="token punctuation">{</span>syslog map<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span></span></span></code></pre><div id="https://www.notion.so/f0d07c4c46794354b37e4823eb0ed73a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><h2 id="https://www.notion.so/b2af14472b7447e9afeec5293afda74e" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/b2af14472b7447e9afeec5293afda74e"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Ensuring Uptime</span></span></h2><div id="https://www.notion.so/9dc5be17238844e19a785a6d3ef07b46" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Docker consider containers to exit with non-zero exit code as crashed, default crash container remain stopped.</span></span></p></div><div id="https://www.notion.so/04ddf85f59e941b98a3c051548ef919b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Here we evaulate log, to diagnose the issue.</span></span></p></div><div id="https://www.notion.so/006a832c825c43eb993ca258282efbc2" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Flag </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">--restart=on-failure:#</code></span><span class="SemanticString"> allows you to say how many times Docker should try again.</span></span></p></div><div id="https://www.notion.so/2c9735fe6ee240a8b6469fd8bb7a6da7" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">--restart=always</code></span><span class="SemanticString"> flag to automatically restart the container when is crashes</span></span></p></div><div id="https://www.notion.so/4ae9948240b04c0aa39a86850182bc53" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Ff4c50a83-ca42-472b-814e-c0e2e15828bc%2FUntitled.png?width=947&amp;table=block&amp;id=4ae99482-40b0-4c0a-a39a-86850182bc53"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Ff4c50a83-ca42-472b-814e-c0e2e15828bc%2FUntitled.png?width=947&amp;table=block&amp;id=4ae99482-40b0-4c0a-a39a-86850182bc53" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/3411df657a2444d6acc015c69685da9b" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Ff927e055-0ed6-4264-9045-1e831aa1dedd%2FUntitled.png?width=951&amp;table=block&amp;id=3411df65-7a24-44d6-acc0-15c69685da9b"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Ff927e055-0ed6-4264-9045-1e831aa1dedd%2FUntitled.png?width=951&amp;table=block&amp;id=3411df65-7a24-44d6-acc0-15c69685da9b" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/1030da86da04468693f3c2cf3b82b549" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><h2 id="https://www.notion.so/57a6649e48b84abdad01bb6a75802428" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/57a6649e48b84abdad01bb6a75802428"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Docker Metadata &amp; Labels</span></span></h2><div id="https://www.notion.so/047a7b4f69204f6694aa8765c110719c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">For containers in production, it&#x27;s helpful to add metadata related to container like version details, who owns it or criteria which server they shud run on.</span></span></p></div><div id="https://www.notion.so/0c6e367068df415ab0e7b9a71d3fbc39" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Additional data managed via Docker Labels, it allows us to define custom metadata about container or image which inspected or used as part of filter.</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/1a7c4da343a0447c8256cadc3b988bf5" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Single Label : </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">l=&lt;value&gt;</code></span></span><pre id="https://www.notion.so/69d5301bc39549beb265b71b804a2815" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>docker run -l <span class="token assign-left variable">user</span><span class="token operator">=</span><span class="token number">12345</span> -d redis</span></span></span></code></pre></li><li id="https://www.notion.so/d91ce2e6311d47cea0cb951a64b34aba" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">External File : while adding multiple labels, add through external file</span></span><pre id="https://www.notion.so/f2bef15254ba4cf99830c5598097bfa6" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># one label for user and second for role</span>
<span class="token builtin class-name">echo</span> 'user<span class="token operator">=</span><span class="token number">12345</span>` <span class="token operator">>></span> labels <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">echo</span> <span class="token string">'role=cache'</span> <span class="token operator">>></span> labels
<span class="token comment"># --labels-file=labels</span>
docker run --label-file<span class="token operator">=</span>labels -d redis</span></span></span></code></pre></li></ul><div id="https://www.notion.so/1b7b5771ce8f4bd5bf899e259dc8b148" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">In case of Dockerfile,</strong></span></span></p></div><div id="https://www.notion.so/76ce3ec6759946af88ebbd0ce8f5668e" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F9516fd26-c777-47c9-9a19-2aae5e1b7e49%2FUntitled.png?width=597&amp;table=block&amp;id=76ce3ec6-7599-46af-88eb-bd0ce8f5668e"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F9516fd26-c777-47c9-9a19-2aae5e1b7e49%2FUntitled.png?width=597&amp;table=block&amp;id=76ce3ec6-7599-46af-88eb-bd0ce8f5668e" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/8a6e9e42998e4811ae37106519ebf612" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">To view labels of container or image, use inspect</span></span></p></div><pre id="https://www.notion.so/a767b302afbe4810b00aa120e9fe99db" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>docker inspect <span class="token operator">&lt;</span>container_name/image_name<span class="token operator">></span></span></span></span></code></pre><div id="https://www.notion.so/d0457c29acbc4cc5a69604903dea4daa" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Daemon Labels</strong></span></span></p></div><div id="https://www.notion.so/af5623cc0203448e86462bd98b600da5" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">When launch instance of daemon, assign label to identify how it should be used.</span></span></p></div><pre id="https://www.notion.so/574e287db7cb4448963010d1e4962d92" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>docker -d -H unix:///var/rn/docker.sock <span class="token punctuation">\</span>
	--label com.katacoda.environment<span class="token operator">=</span><span class="token string">"production"</span></span></span></span></code></pre><div id="https://www.notion.so/5c71fc36c6854e7f85a9a79773eaefb4" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/a873f3df84ec4e50ab65d95841186a50" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><h2 id="https://www.notion.so/2fd5597d3b814bedb6243a5fd3f1f445" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/2fd5597d3b814bedb6243a5fd3f1f445"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Load Balancing Containers</span></span></h2><div id="https://www.notion.so/809ce27b2e4c49e99bf34c448e9353ec" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Here, we use the NGINX web server to load balance requests between two containers running on the host</span></span></p></div><div id="https://www.notion.so/954b76ff977d4369b496caf1f97bcabb" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">The Service Discovery pattern is where the application uses a third party system to identify the location of the target service. For example, if our application wanted to talk to a database, it would first ask an API what the IP address of the database is.</span></span></p></div><div id="https://www.notion.so/033085b2941d45438e6fce6d9e46b97b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Step 1 - NGINX Proxy</strong></span></span></p></div><div id="https://www.notion.so/e14681570dd7440e872da44074f28924" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Nginx service running → dynamically discovery and update load balance configuration when new containers loaded.</span></span></p></div><div id="https://www.notion.so/e50c7758d4a54719b7cee96235c98cfc" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Properties -</strong></span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/40d982e44d48469f8e9c14bf177381c4" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">First Port binding : here -p 80:80</span></span></li><li id="https://www.notion.so/f639e07ef147477689d0941bb99a1a3b" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Second mount docker.sock file, it&#x27;s connection to docker daemon running on host; -v /var/run/docker.sock:/tmp/docker.sock:ro </span></span></li><li id="https://www.notion.so/389bfbef6f1e4d5aa3d8d6e7883f25d4" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Third if request comes and it doesn&#x27;t make to specified host, then this default container will handle request : -e DEFAULTHOST=&lt;domain&gt;</span></span></li></ul><pre id="https://www.notion.so/75c6c458dd01455e834d8830408cf352" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>docker run -d -p <span class="token number">80</span>:80 -e <span class="token assign-left variable">DEFAULT_HOST</span><span class="token operator">=</span>proxy.example -v /var/run/docker.sock:/tmp/docker.sock:ro --name nginx jwilder/nginx-proxy</span></span></span></code></pre><div id="https://www.notion.so/9f040ea834b644f8a6a8382527252283" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Step 2 - Launch Contianer</strong></span></span></p></div><div id="https://www.notion.so/756ed80862f24cd8b77f61b892bb02e9" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Specify VIRTUAL_HOST env variable, to define the domain where requests will come from and should be handled by container.</span></span></p></div><pre id="https://www.notion.so/a3e001bf2e3d43d2879bb7f32bcea2f1" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>docker run -d -p <span class="token number">80</span> -e <span class="token assign-left variable">VIRTUAL_HOST</span><span class="token operator">=</span>proxy.example katacoda/docker-http-server</span></span></span></code></pre><div id="https://www.notion.so/8f050304431e46ad9c2cb0be3c000bd3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Step 3 - Cluster</strong></span></span></p></div><div id="https://www.notion.so/f8fba288352c41cab6d4f18055621559" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Launch second container on same Vhost, after nginx-proxy configure the system in round-robin load balance (the first request will go to one container, the second request to a second container and then repeat in a circle).</span></span></p></div><pre id="https://www.notion.so/2eed2a02130145ae88c62327eca96c34" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># second container</span>
docker run -d -p <span class="token number">80</span> -e <span class="token assign-left variable">VIRTUAL_HOST</span><span class="token operator">=</span>proxy.example katacoda/docker-http-server</span></span></span></code></pre><div id="https://www.notion.so/20d0831ab55e42a38e91ad725564e080" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Step 4 - Auto generated NGINX config</strong></span></span></p></div><div id="https://www.notion.so/ae38709339cf46e8858a50d979a6db4c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Nginx-proxy auto create and configs nginx, to check final config file.</span></span></p></div><pre id="https://www.notion.so/94f5599da41242ef84997e334aa285c2" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>docker <span class="token builtin class-name">exec</span> nginx <span class="token function">cat</span> /etc/nginx/conf.d/default.conf</span></span></span></code></pre><div id="https://www.notion.so/1e8e01f18bff4e17ab090ae6666b967a" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Faacc0288-078a-41a9-90a1-890bc0ce5adb%2FUntitled.png?width=1216&amp;table=block&amp;id=1e8e01f1-8bff-4e17-ab09-0ae6666b967a"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Faacc0288-078a-41a9-90a1-890bc0ce5adb%2FUntitled.png?width=1216&amp;table=block&amp;id=1e8e01f1-8bff-4e17-ab09-0ae6666b967a" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/081f0973473a42e896bae3edc8eb9302" class="Divider"></div><h2 id="https://www.notion.so/f54b85c7e4274f16bc29d642332f5e32" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/f54b85c7e4274f16bc29d642332f5e32"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Docker-Compose</span></span></h2><pre id="https://www.notion.so/abe766cec82d4588ac481cac672fdf83" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># to see details of launched container</span>
docker-compose <span class="token function">ps</span>

<span class="token comment"># access logs via stream</span>
docker-compose logs

<span class="token comment"># scale the number of web containers, following will scale no of web container</span>
docker-compose scale <span class="token assign-left variable">web</span><span class="token operator">=</span><span class="token number">3</span> 
<span class="token comment"># scale down back to one</span>
docker-compose scale <span class="token assign-left variable">web</span><span class="token operator">=</span><span class="token number">1</span>

<span class="token comment"># docker stop</span>
docker-compose stop</span></span></span></code></pre><h2 id="https://www.notion.so/a13ca16dae6142209e333fd54a2b4d16" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/a13ca16dae6142209e333fd54a2b4d16"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Docker stats</span></span></h2><pre id="https://www.notion.so/fee8e0787af64303bf60152dc889fcae" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># For single container</span>
docker stats nginx

<span class="token comment"># For multiple container</span>
docker <span class="token function">ps</span> -q <span class="token operator">|</span> <span class="token function">xargs</span> docker stats</span></span></span></code></pre><h2 id="https://www.notion.so/5576216c13e04288ac905f7ed4086d42" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/5576216c13e04288ac905f7ed4086d42"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Formatting Docker ps output</span></span></h2><div id="https://www.notion.so/9bc47669acb94567a0c7dc5a4345e081" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F8c56ecbe-414b-4340-a94f-4303e935a49f%2FUntitled.png?width=1245&amp;table=block&amp;id=9bc47669-acb9-4567-a0c7-dc5a4345e081"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F8c56ecbe-414b-4340-a94f-4303e935a49f%2FUntitled.png?width=1245&amp;table=block&amp;id=9bc47669-acb9-4567-a0c7-dc5a4345e081" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/418fbcd9ed094c208deeeab048d91ebd" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Here, docker ps output name, image used, command, uptime and port info.</span></span></p></div><div id="https://www.notion.so/dea7149674994d00a734f1a2e6f4dacd" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">To limit column displayed, —format &#x27;_pattern&#x27;</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/12e2003e90a843baa38c6bd516113f67" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Print name and Image</span></span></li></ul><pre id="https://www.notion.so/330345d49a5348b1b030593dc97140c7" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># print in single line</span>
docker <span class="token function">ps</span> --format <span class="token string">'{{.Name}} container is using {{.Imgae}} image'</span>
<span class="token comment"># print in table format</span>
docker <span class="token function">ps</span> --format <span class="token string">'table {{.Name}}<span class="token entity" title="\t">\t</span>{{.Image}}'</span>

<span class="token comment"># print all ip addr for running container</span>
docker <span class="token function">ps</span> -q <span class="token operator">|</span> <span class="token function">xargs</span> docker inspect --format <span class="token string">'{{ .Id }} - {{ .Name }} - {{ .NetworkSettings.IPAddress }}'</span></span></span></span></code></pre><div id="https://www.notion.so/d3ef8079b4904455823e0912d755bf86" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fbe90bbee-775e-4f6d-a2be-aa8b01726110%2FUntitled.png?width=984&amp;table=block&amp;id=d3ef8079-b490-4455-823e-0912d755bf86"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fbe90bbee-775e-4f6d-a2be-aa8b01726110%2FUntitled.png?width=984&amp;table=block&amp;id=d3ef8079-b490-4455-823e-0912d755bf86" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/5d8612a25ff6437e8f3b1109a11ae603" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">(source : </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://docs.docker.com/engine/reference/commandline/ps/">https://docs.docker.com/engine/reference/commandline/ps/</a></span><span class="SemanticString"> )</span></span></p></div><div id="https://www.notion.so/0da5fb74eaf34569aa460dbbec19f92d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><h2 id="https://www.notion.so/724260182f4044fca48f4970abba5c08" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/724260182f4044fca48f4970abba5c08"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Rootless Docker</span></span></h2><div id="https://www.notion.so/74946d129ea64150bc794965082171a0" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Rootless Docker is a project from Docker that removes the requirement for the Docker Daemon to be started by a root. This creates a more secure environment.</span></span></p></div><h1 id="https://www.notion.so/132ac886ee0e43aa82da4e6f79c57b1d" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/132ac886ee0e43aa82da4e6f79c57b1d"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Swarm mode</span></span></h1><div id="https://www.notion.so/e76564ba0a6647ae9603ec7d1ff75c9d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">It enables ability to deploy container across multiple Docker hosts, using overlay network for service discovery with build-in load balancer.</span></span></p></div><div id="https://www.notion.so/4c95dd58b77d49168ab61b3b0d52a2cb" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Concepts :</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/b4a3e5fb8c7642bebc0ff28a7a01284f" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Node </strong></span><span class="SemanticString">: instance of docker engine connected to swarm. Nodes are either workers or managers. Manager schedule which container to run where and workers execute the task.</span></span></li><li id="https://www.notion.so/80d8d0fee5e749d7b3110f694ed0ed6f" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Services </strong></span><span class="SemanticString">: collection of tasks executed by workers.</span></span></li><li id="https://www.notion.so/ddc61dbca0a5473c9f16eaef1cd3432f" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Load balancing</strong></span><span class="SemanticString"> : load balancer to process requests across all container in service.  </span></span></li></ul><h3 id="https://www.notion.so/fea17c987d4447d0967d1eceffd0e3fa" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/fea17c987d4447d0967d1eceffd0e3fa"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Step 1: Initialise Swarm mode</span></span></h3><div id="https://www.notion.so/424a38e0995545f29fd39011201a3d6e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">After it Docker becomes manages by default, i.e. first node to initialize. New nodes join the cluster, they adjust their role between manager and workers.</span></span></p></div><pre id="https://www.notion.so/a534b043c4d8401b8da58238b81c074f" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># Initialise Swarm mode, it'll output init token which used to add additional nodes.</span>
docker swarm init</span></span></span></code></pre><h3 id="https://www.notion.so/357e0bb8408d4fda83639492e07615e9" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/357e0bb8408d4fda83639492e07615e9"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Step 2: Join Cluster</span></span></h3><div id="https://www.notion.so/5a52c4555cf34bc8952396364bebb67b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Joining is done by pointing other host to current manager of cluster.</span></span></p></div><div id="https://www.notion.so/7eb7f466a74d4259ab693a59927fa0ec" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Docker uses port 2377 for swarm managing.</span></span></p></div><div id="https://www.notion.so/aa1a07c294b54115958de14724baf74a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">On second host,</span></span></p></div><pre id="https://www.notion.so/4f9ec1c6c60e4683b6a595876b71de2b" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># first task to obtain token is to add worker to cluster</span>
<span class="token comment"># here we ask manager what's the token via `swarm join-token`</span>
<span class="token assign-left variable">token</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">ssh</span> -o <span class="token assign-left variable">StrictHostKeyChecking</span><span class="token operator">=</span>no <span class="token number">172.17</span>.0.77 <span class="token string">"docker swarm join-token -q worker"</span><span class="token variable">)</span></span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">echo</span> <span class="token variable">$token</span>
<span class="token comment"># join the requesting access</span>
docker swarm <span class="token function">join</span> <span class="token number">172.17</span>.0.77:2377 --token <span class="token variable">$token</span>
<span class="token comment"># view nodes in cluster</span>
docker node <span class="token function">ls</span></span></span></span></code></pre><h3 id="https://www.notion.so/97beca2997074a3692b08922ed4ac518" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/97beca2997074a3692b08922ed4ac518"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Step 3: Create overlay network</span></span></h3><div id="https://www.notion.so/a8dc3c6c093c48079075dd27d541e4c9" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">The overlay network used to enable containers on diff hosts to communicate, this is Virtual Extensible LAN (VXLAN)</span></span></p></div><pre id="https://www.notion.so/101ba1ec523347f6815da56504d3fb26" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># create new overlay network called skynet, all container registered to this node can communicate with each other</span>
docker network create -d overlay skynet</span></span></span></code></pre><h3 id="https://www.notion.so/718a5534785b46cda7bede09f26c2646" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/718a5534785b46cda7bede09f26c2646"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Step 4: Deploy service</span></span></h3><div id="https://www.notion.so/a0b08a1e87914385b82569fe741b1402" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Services used to run containers across the cluster, it allows to define how applications deployed at scale.</span></span></p></div><pre id="https://www.notion.so/a1e8e23adbc64ae698d19203492dea97" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># to ensure availablity, we run two replicas</span>
docker <span class="token function">service</span> create --name http --network skynet --replicas <span class="token number">2</span> -p <span class="token number">80</span>:80 docker-http-service
<span class="token comment"># view running service</span>
docker <span class="token function">service</span> <span class="token function">ls</span></span></span></span></code></pre><h3 id="https://www.notion.so/96874085263240d79744ff6524ff1e78" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/96874085263240d79744ff6524ff1e78"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Step 5: Inspect State</span></span></h3><div id="https://www.notion.so/7715e03166954c82aca86b02bd588584" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Inspect health and state of cluster and running applications.</span></span></p></div><pre id="https://www.notion.so/327842e6bcec41c383eed4282edb0113" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># view list of task with service across the cluster</span>
docker <span class="token function">service</span> <span class="token function">ps</span> http
<span class="token comment"># view details and config of service</span>
docker <span class="token function">service</span> inspect --pretty http
<span class="token comment"># on each node, self refers to manager node</span>
docker node <span class="token function">ps</span> self</span></span></span></code></pre><h3 id="https://www.notion.so/27c164f9bf6c428b8bf7cee9f62c80e7" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/27c164f9bf6c428b8bf7cee9f62c80e7"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Step 6: Scale service</span></span></h3><div id="https://www.notion.so/9698b380013a44f982aff5dfc26d8fa3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Service allows to scale many instances of running task across the cluster.</span></span></p></div><pre id="https://www.notion.so/0e5c28276dea4b95b6a247c0550bcffb" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># scale http service to running across five contianer</span>
docker <span class="token function">service</span> scale <span class="token assign-left variable">http</span><span class="token operator">=</span><span class="token number">5</span> </span></span></span></code></pre></article>  <footer class="Footer">
        <div>&copy; Vizlog 2021</div>
        <div>&centerdot;</div>
        <div>Powered by <a href="https://github.com/dragonman225/notablog" target="_blank"
            rel="noopener noreferrer">Notablog</a>.
        </div>
    </footer>
</body>

</html>
